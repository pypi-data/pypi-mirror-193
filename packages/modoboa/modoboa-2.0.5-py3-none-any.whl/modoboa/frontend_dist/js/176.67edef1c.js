"use strict";(self["webpackChunkModoboa"]=self["webpackChunkModoboa"]||[]).push([[176],{322:function(t,e,i){i.d(e,{Z:function(){return b}});var a=i(344),s=i(4562),n=i(4145),o=i(4886),r=i(3863),l=i(4324),m=i(3687),d=function(){var t=this,e=t._self._c;return e(n.Z,[e(o.EB,[e("span",{staticClass:"headline"},[t.dialogMode?e("translate",{staticClass:"headline"},[t._v("Administrators of "+t._s(t.domain.name))]):e("translate",{staticClass:"headline"},[t._v("Administrators")])],1)]),e(o.ZB,[e(r.Z,{attrs:{headers:t.headers,items:t.administrators,"hide-default-footer":""},scopedSlots:t._u([{key:"item.username",fn:function({item:i}){return[i.id?e("span",[t._v(t._s(i.username))]):e(a.Z,{attrs:{label:t._f("translate")("Select an account"),items:t.accounts,"item-text":"username","return-object":""},scopedSlots:t._u([{key:"append-outer",fn:function(){return[t.selectedAccount?e(s.Z,{attrs:{icon:"",color:"primary"},on:{click:t.addAdministrator}},[e(l.Z,[t._v("mdi-content-save")])],1):t._e()]},proxy:!0}],null,!0),model:{value:t.selectedAccount,callback:function(e){t.selectedAccount=e},expression:"selectedAccount"}})]}},{key:"item.name",fn:function({item:e}){return[t._v(" "+t._s(e.first_name)+" "+t._s(e.last_name)+" ")]}},{key:"item.actions",fn:function({item:i}){return[i.id?e(s.Z,{attrs:{icon:"",color:"red",title:t._f("translate")("Remove this administrator")},on:{click:function(e){return t.removeAdministrator(i)}}},[e(l.Z,[t._v("mdi-delete-outline")])],1):t._e()]}}])}),t.hideAddBtn?t._e():e(s.Z,{attrs:{small:"",color:"primary",outlined:""},on:{click:t.addRow}},[e(l.Z,{attrs:{small:""}},[t._v("mdi-plus")]),t._v(" "),e("translate",[t._v("Add administrator")])],1)],1),t.dialogMode?e(o.h7,[e(m.Z),e(s.Z,{attrs:{color:"grey darken-1",text:""},on:{click:t.close}},[e("translate",[t._v("Close")])],1)],1):t._e()],1)},c=[],h=(i(7658),i(4736)),u=i(7913),p=i(1662),f={props:{domain:Object,dialogMode:{type:Boolean,default:!1}},data(){return{accounts:[],administrators:[],headers:[{text:this.$gettext("Username"),value:"username"},{text:this.$gettext("Name"),value:"name"},{text:"",value:"actions",align:"right",sortable:!1}],hideAddBtn:!1,selectedAccount:null}},methods:{addRow(){this.administrators.push({}),this.hideAddBtn=!0},close(){this.$emit("close"),this.hideAddBtn=!1},fetchAdministrators(t){u.Z.getDomainAdministrators(t.pk).then((t=>{this.administrators=t.data}))},fetchAccounts(){h.Z.getAll({role:"DomainAdmins"}).then((t=>{this.accounts=t.data.filter((t=>void 0===this.administrators.find((e=>e.id===t.pk))))}))},addAdministrator(){u.Z.addDomainAdministrator(this.domain.pk,this.selectedAccount.pk).then((t=>{this.fetchAdministrators(this.domain),this.accounts=this.accounts.filter((t=>t.pk!==this.selectedAccount.pk)),this.selectedAccount=null,this.hideAddBtn=!1,p.$.$emit("notification",{msg:this.$gettext("Administrator added")})}))},removeAdministrator(t){u.Z.removeDomainAdministrator(this.domain.pk,t.id).then((t=>{this.fetchAdministrators(this.domain),this.fetchAccounts(),p.$.$emit("notification",{msg:this.$gettext("Administrator removed")})}))}},watch:{domain:{handler:function(t){this.fetchAdministrators(t),this.fetchAccounts()},immediate:!0}}},_=f,g=i(1001),v=(0,g.Z)(_,d,c,!1,null,null,null),b=v.exports},8319:function(t,e,i){i.r(e),i.d(e,{default:function(){return Ct}});var a=i(4562),s=i(4061),n=i(4324),o=i(5808),r=i(4525),l=i(9378),m=i(4528),d=i(3687),c=i(6313),h=i(7953),u=function(){var t=this,e=t._self._c;return e("div",[e(c.Z,{attrs:{flat:""}},[e(h.qW,[e("translate",[t._v("Domains")])],1),e(d.Z),e(a.Z,{staticClass:"mr-2",attrs:{title:t._f("translate")("Import domains and aliases from CSV file")},on:{click:function(e){t.showImportForm=!0}}},[e(n.Z,[t._v("mdi-file-import-outline")])],1),e(a.Z,{staticClass:"mr-2",attrs:{title:t._f("translate")("Export domains and aliases to CSV")},on:{click:t.exportDomains}},[e(n.Z,[t._v("mdi-file-export-outline")])],1),e(m.Z,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:s}){return[e(a.Z,t._g(t._b({attrs:{color:"primary"}},"v-btn",s,!1),i),[e(n.Z,{attrs:{left:""}},[t._v("mdi-plus")]),e("translate",[t._v("New")])],1)]}}])},[e(o.Z,{attrs:{dense:""}},[e(r.Z,{on:{click:function(e){t.showDomainWizard=!0}}},[e(l.V9,[e("translate",[t._v("Domain")])],1)],1),e(r.Z,{on:{click:function(e){t.showAliasForm=!0}}},[e(l.V9,[e("translate",[t._v("Alias")])],1)],1)],1)],1)],1),e("domain-list"),e(s.Z,{attrs:{fullscreen:"",scrollable:"",transition:"dialog-bottom-transition"},model:{value:t.showDomainWizard,callback:function(e){t.showDomainWizard=e},expression:"showDomainWizard"}},[e("domain-creation-form",{on:{close:function(e){t.showDomainWizard=!1}}})],1),e(s.Z,{attrs:{persistent:"","max-width":"800px"},model:{value:t.showAliasForm,callback:function(e){t.showAliasForm=e},expression:"showAliasForm"}},[e("domain-alias-form",{on:{close:function(e){t.showAliasForm=!1}}})],1),e(s.Z,{attrs:{persistent:"","max-width":"800px"},model:{value:t.showImportForm,callback:function(e){t.showImportForm=e},expression:"showImportForm"}},[e("import-form",{ref:"importForm",attrs:{title:t._f("translate")("Import domains")},on:{submit:t.importDomains,close:function(e){t.showImportForm=!1}},scopedSlots:t._u([{key:"help",fn:function(){return[e("ul",[e("li",[e("em",[t._v("domain; name; quota; default mailbox quota; enabled")])]),e("li",[e("em",[t._v("domainalias; name; targeted domain; enabled")])]),e("li",[e("em",[t._v("relaydomain; name; target host; target port; service; enabled; verify recipients")])])])]},proxy:!0}])})],1)],1)},p=[],f=i(7913),_=i(4145),g=i(4886),v=i(9559),b=i(9884),x=i(7808),$=function(){var t=this,e=t._self._c;return e(_.Z,[e(g.EB,[e("span",{staticClass:"headline"},[t._v(t._s(t.title))])]),e(g.ZB,[e("validation-observer",{ref:"observer"},[e("validation-provider",{attrs:{name:"name",rules:"required"},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("label",{staticClass:"m-label"},[t._v(t._s(t.$gettext("Name")))]),e(x.Z,{attrs:{dense:"",outlined:"","error-messages":i},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})]}}])}),e("validation-provider",{attrs:{name:"target",rules:"required"},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("label",{staticClass:"m-label"},[t._v(t._s(t.$gettext("Choose a domain")))]),e(v.Z,{attrs:{items:t.domains,"item-text":"name","item-value":"pk","error-messages":i,"single-line":"",dense:"",outlined:""},model:{value:t.form.target,callback:function(e){t.$set(t.form,"target",e)},expression:"form.target"}})]}}])}),e(b.Z,{attrs:{label:"Enabled",color:"primary"},model:{value:t.form.enabled,callback:function(e){t.$set(t.form,"enabled",e)},expression:"form.enabled"}})],1)],1),e(g.h7,[e(d.Z),e(a.Z,{on:{click:t.close}},[e("translate",[t._v("Close")])],1),t.domainAlias&&t.domainAlias.pk?e(a.Z,{attrs:{color:"error"},on:{click:t.deleteAlias}},[e("translate",[t._v("Delete")])],1):t._e(),e(a.Z,{attrs:{color:"primary"},on:{click:t.submit}},[t._v(" "+t._s(t.submitLabel)+" ")])],1)],1)},k=[],y=i(629),A=i(1662),Z={props:{domainAlias:{type:Object,default:()=>null}},computed:{...(0,y.Se)({domains:"domains/domains"}),submitLabel(){return this.domainAlias?this.$gettext("Update"):this.$gettext("Add")},title(){return this.domainAlias?this.$gettext("Edit domain alias"):this.$gettext("Add a new domain alias")}},data(){return{form:{enabled:!0}}},methods:{close(){this.$emit("close"),this.form={enabled:!0}},deleteAlias(){f.Z.deleteDomainAlias(this.domainAlias.pk).then((t=>{this.$emit("alias-deleted"),A.$.$emit("notification",{msg:this.$gettext("Domain alias deleted")})}))},async submit(){const t=await this.$refs.observer.validate();if(t)try{if(this.form.pk){const t=JSON.parse(JSON.stringify(this.form));t.target=t.target.pk,await f.Z.updateDomainAlias(this.form.pk,t).then((t=>{A.$.$emit("notification",{msg:this.$gettext("Domain alias updated")}),this.close()}))}else await f.Z.createDomainAlias(this.form).then((t=>{A.$.$emit("notification",{msg:this.$gettext("Domain alias created")}),this.$emit("alias-created",t.data),this.close()}))}catch(e){this.$refs.observer.setErrors(e.response.data)}}},mounted(){this.domainAlias&&(this.form=JSON.parse(JSON.stringify(this.domainAlias)))},watch:{domainAlias(t){t&&(this.form=JSON.parse(JSON.stringify(t)))}}},w=Z,D=i(1001),C=(0,D.Z)(w,$,k,!1,null,null,null),S=C.exports,F=i(266),B=i(1713),N=function(){var t=this,e=t._self._c;return e("creation-form",{attrs:{title:t._f("translate")("New domain"),steps:t.steps,"form-observer-getter":t.getObserver,"validate-object":t.validateDomain,"summary-sections":t.summarySections},on:{close:t.close,create:t.submit},scopedSlots:t._u([{key:"form.general",fn:function({step:i}){return[e("domain-general-form",{ref:`form_${i}`,model:{value:t.domain,callback:function(e){t.domain=e},expression:"domain"}})]}},{key:"form.dns",fn:function({step:i}){return[e("domain-dns-form",{ref:`form_${i}`,model:{value:t.domain,callback:function(e){t.domain=e},expression:"domain"}})]}},{key:"form.limitations",fn:function({step:i}){return[e("domain-limitations-form",{ref:`form_${i}`,model:{value:t.domain,callback:function(e){t.domain=e},expression:"domain"}})]}},{key:"form.options",fn:function({step:i}){return[e("domain-options-form",{ref:`form_${i}`,on:{createAdmin:t.updateCreateAdmin},model:{value:t.domain,callback:function(e){t.domain=e},expression:"domain"}})]}},{key:"form.transport",fn:function({step:i}){return[e("domain-transport-form",{ref:`form_${i}`,model:{value:t.domain.transport,callback:function(e){t.$set(t.domain,"transport",e)},expression:"domain.transport"}})]}},{key:"item.with_random_password",fn:function({item:i}){return[i.value?[e(F.Z,{staticClass:"highligth white--text",attrs:{cols:"12"}},[e(B.Z,[e(F.Z,[e("span",[t._v(t._s(i.key))])]),e(F.Z,{staticClass:"text-right"},[t._v(t._s(t._f("yesno")(i.value)))])],1),e(B.Z,[e(F.Z,{staticClass:"text-right py-1"},[t._v(" "+t._s(t.domain.domain_admin.password)+" "),e(a.Z,{attrs:{icon:"",color:"white",title:t._f("translate")("Copy to clipboard")},on:{click:t.copyPassword}},[e(n.Z,[t._v("mdi-clipboard-multiple-outline")])],1)],1)],1)],1)]:[e(F.Z,[e("span",{staticClass:"grey--text"},[t._v(t._s(i.key))])]),e(F.Z,{staticClass:"text-right"},[t._v(t._s(t._f("yesno")(i.value)))])]]}}])})},O=[],L=(i(7658),i(4865)),q=i(8529),E=i(8034),I=i(5342),M=function(){var t=this,e=t._self._c;return e("validation-observer",{ref:"observer"},[e(b.Z,{attrs:{label:t._f("translate")("Create a domain administrator")},on:{change:t.updateCreateAdmin},model:{value:t.createAdmin,callback:function(e){t.createAdmin=e},expression:"createAdmin"}}),e("validation-provider",{attrs:{rules:t.createAdmin?"required":""},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e(x.Z,{attrs:{label:t._f("translate")("Name"),hint:t._f("translate")("Name of the administrator"),"persistent-hint":"","error-messages":i,outlined:"",disabled:!t.createAdmin,suffix:`@${t.value.name}`},on:{input:t.update},model:{value:t.form.domain_admin.username,callback:function(e){t.$set(t.form.domain_admin,"username",e)},expression:"form.domain_admin.username"}})]}}])}),e(b.Z,{attrs:{label:t._f("translate")("Random password"),disabled:!t.createAdmin,hint:t._f("translate")("Generate a random password for the administrator."),"persistent-hint":""},on:{change:t.updatePassword,input:t.update},model:{value:t.form.domain_admin.with_random_password,callback:function(e){t.$set(t.form.domain_admin,"with_random_password",e)},expression:"form.domain_admin.with_random_password"}}),e(b.Z,{attrs:{label:t._f("translate")("With a mailbox"),disabled:!t.createAdmin,hint:t._f("translate")("Create a mailbox for the administrator."),"persistent-hint":""},on:{input:t.update},model:{value:t.form.domain_admin.with_mailbox,callback:function(e){t.$set(t.form.domain_admin,"with_mailbox",e)},expression:"form.domain_admin.with_mailbox"}}),e(b.Z,{attrs:{label:t._f("translate")("Create aliases"),disabled:!t.createAdmin,hint:t._f("translate")("Create standard aliases for the domain."),"persistent-hint":""},on:{input:t.update},model:{value:t.form.domain_admin.with_aliases,callback:function(e){t.$set(t.form.domain_admin,"with_aliases",e)},expression:"form.domain_admin.with_aliases"}})],1)},R=[],W=i(4736),P={props:["value"],data(){return{createAdmin:!1,form:{}}},methods:{updatePassword(t){t?W.Z.getRandomPassword().then((t=>{this.$set(this.form.domain_admin,"password",t.data.password),this.update()})):(delete this.form.domain_admin.password,this.update())},updateCreateAdmin(t){this.$emit("createAdmin",t)},update(){this.$emit("input",this.form)}},watch:{value:{handler:function(t){this.form={...this.value}},immediate:!0}}},z=P,T=(0,D.Z)(z,M,R,!1,null,null,null),J=T.exports,X=i(7875),Y={props:["value"],components:{CreationForm:L.Z,"domain-dns-form":q.Z,DomainGeneralForm:E.Z,DomainLimitationsForm:I.Z,DomainOptionsForm:J,DomainTransportForm:X.Z},computed:{summarySections(){const t=[{title:this.$gettext("General"),items:[{key:this.$gettext("Name"),value:this.domain.name},{key:this.$gettext("Type"),value:this.domain.type},{key:this.$gettext("Enabled"),value:this.domain.enabled,type:"yesno"}]},{title:this.$gettext("DNS"),items:[{key:this.$gettext("Enable DNS checks"),value:this.domain.enable_dns_checks,type:"yesno"},{key:this.$gettext("Enable DKIM signing"),value:this.domain.enable_dkim,type:"yesno"}]},{title:this.$gettext("Limitations"),items:[{key:this.$gettext("Quota"),value:this.domain.quota},{key:this.$gettext("Default mailbox quota"),value:this.domain.default_mailbox_quota},{key:this.$gettext("Message sending limit"),value:this.domain.message_sending_limit}]}];if(this.domain.enable_dkim&&(t[1].items.push({key:this.$gettext("DKIM key selector"),value:this.domain.dkim_key_selector}),t[1].items.push({key:this.$gettext("DKIM key length"),value:this.domain.dkim_key_length})),this.createAdmin&&t.push({title:this.$gettext("Options"),items:[{key:this.$gettext("Create a domain administrator"),value:this.createAdmin,type:"yesno"},{key:this.$gettext("Administrator name"),value:this.domain.domain_admin.username},{name:"with_random_password",key:this.$gettext("Random password"),value:this.domain.domain_admin.with_random_password,type:"yesno"},{key:this.$gettext("With mailbox"),value:this.domain.domain_admin.with_mailbox,type:"yesno"},{key:this.$gettext("Create aliases"),value:this.domain.domain_admin.with_aliases,type:"yesno"}]}),"relaydomain"===this.domain.type){const e={title:this.$gettext("Transport"),items:[{key:this.$gettext("Service"),value:this.domain.transport.service}]};if(this.$refs.form_4.service){const t=this.$refs.form_4.service;for(const i of t.settings){const a={key:i.label,value:this.domain.transport.settings[`${t.name}_${i.name}`]};"boolean"===i.type&&(a.type="yesno"),e.items.push(a)}}t.push(e)}return t},steps(){return"domain"===this.domain.type?this.domainSteps:this.relaySteps}},data(){return{createAdmin:!1,domain:{domain_admin:{}},formErrors:{},domainSteps:[{name:"general",title:this.$gettext("General")},{name:"dns",title:this.$gettext("DNS")},{name:"limitations",title:this.$gettext("Limitations")},{name:"options",title:this.$gettext("Options")}],relaySteps:[{name:"general",title:this.$gettext("General")},{name:"dns",title:this.$gettext("DNS")},{name:"limitations",title:this.$gettext("Limitations")},{name:"transport",title:this.$gettext("Transport")}]}},mounted(){this.initDomain()},methods:{copyPassword(){navigator.clipboard.writeText(this.domain.domain_admin.password).then((()=>{A.$.$emit("notification",{msg:this.$gettext("Password copied to clipboard")})}))},initDomain(){this.domain={name:"",type:"domain",enabled:!0,enable_dns_checks:!0,enable_dkim:!1,dkim_key_selector:"modoboa",quota:0,default_mailbox_quota:0,domain_admin:{username:"admin",with_random_password:!1,with_mailbox:!1,with_aliases:!1},transport:{}}},close(){this.initDomain(),this.$emit("close")},getObserver(t){return this.$refs[`form_${t}`].$refs.observer},validateDomain(){},updateCreateAdmin(t){this.createAdmin=t},submit(){const t=JSON.parse(JSON.stringify(this.domain));this.createAdmin||delete t.domain_admin,"relaydomain"===t.type?this.$refs.form_4.checkSettingTypes(t):delete t.transport,this.$store.dispatch("domains/createDomain",t).then((t=>{this.$router.push({name:"DomainDetail",params:{id:t.data.pk}}),A.$.$emit("notification",{msg:this.$gettext("Domain created")}),this.close()}))}}},j=Y,G=(0,D.Z)(j,N,O,!1,null,null,null),V=G.exports,K=(i(541),i(6878)),U=i(6669),Q=i(1444),H=i(4971),tt=i(4263),et=i(7678),it=i(5352),at=(0,et.Z)(K.Z,(0,tt.d)(["left","bottom"]),U.Z,Q.Z,H.Z).extend({name:"v-badge",props:{avatar:Boolean,bordered:Boolean,color:{type:String,default:"primary"},content:{required:!1},dot:Boolean,label:{type:String,default:"$vuetify.badge"},icon:String,inline:Boolean,offsetX:[Number,String],offsetY:[Number,String],overlap:Boolean,tile:Boolean,transition:{type:String,default:"scale-rotate-transition"},value:{default:!0}},computed:{classes(){return{"v-badge--avatar":this.avatar,"v-badge--bordered":this.bordered,"v-badge--bottom":this.bottom,"v-badge--dot":this.dot,"v-badge--icon":null!=this.icon,"v-badge--inline":this.inline,"v-badge--left":this.left,"v-badge--overlap":this.overlap,"v-badge--tile":this.tile,...this.themeClasses}},computedBottom(){return this.bottom?"auto":this.computedYOffset},computedLeft(){return this.isRtl?this.left?this.computedXOffset:"auto":this.left?"auto":this.computedXOffset},computedRight(){return this.isRtl?this.left?"auto":this.computedXOffset:this.left?this.computedXOffset:"auto"},computedTop(){return this.bottom?this.computedYOffset:"auto"},computedXOffset(){return this.calcPosition(this.offsetX)},computedYOffset(){return this.calcPosition(this.offsetY)},isRtl(){return this.$vuetify.rtl},offset(){return this.overlap?this.dot?8:12:this.dot?2:4},styles(){return this.inline?{}:{bottom:this.computedBottom,left:this.computedLeft,right:this.computedRight,top:this.computedTop}}},methods:{calcPosition(t){return`calc(100% - ${(0,it.kb)(t||this.offset)})`},genBadge(){const t=this.$vuetify.lang,e=this.$attrs["aria-label"]||t.t(this.label),i=this.setBackgroundColor(this.color,{staticClass:"v-badge__badge",style:this.styles,attrs:{"aria-atomic":this.$attrs["aria-atomic"]||"true","aria-label":e,"aria-live":this.$attrs["aria-live"]||"polite",title:this.$attrs.title,role:this.$attrs.role||"status"},directives:[{name:"show",value:this.isActive}]}),a=this.$createElement("span",i,[this.genBadgeContent()]);return this.transition?this.$createElement("transition",{props:{name:this.transition,origin:this.origin,mode:this.mode}},[a]):a},genBadgeContent(){if(this.dot)return;const t=(0,it.z9)(this,"badge");return t||(this.content?String(this.content):this.icon?this.$createElement(n.Z,this.icon):void 0)},genBadgeWrapper(){return this.$createElement("span",{staticClass:"v-badge__wrapper"},[this.genBadge()])}},render(t){const e=[this.genBadgeWrapper()],i=[(0,it.z9)(this)],{"aria-atomic":a,"aria-label":s,"aria-live":n,role:o,title:r,...l}=this.$attrs;return this.inline&&this.left?i.unshift(e):i.push(e),t("span",{staticClass:"v-badge",attrs:l,class:this.classes},i)}}),st=i(3486),nt=i(4127),ot=i(3863),rt=i(9592),lt=function(){var t=this,e=t._self._c;return e(_.Z,{staticClass:"mt-6"},[e(c.Z,{attrs:{flat:""}},[e(m.Z,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:s}){return[e(a.Z,t._g(t._b({attrs:{small:""}},"v-btn",s,!1),i),[t._v(" Actions "),e(n.Z,{attrs:{right:""}},[t._v("mdi-chevron-down")])],1)]}}])},[e(o.Z,{attrs:{dense:""}})],1),e(d.Z),e(x.Z,{attrs:{"prepend-inner-icon":"mdi-magnify",placeholder:"Search",filled:"",outlined:"",dense:"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),e(ot.Z,{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.domains,search:t.search,"item-key":"name","show-select":"","single-expand":"",expanded:t.expanded},on:{"update:expanded":function(e){t.expanded=e},"item-expanded":t.loadAliases,"click:row":t.showAliases},scopedSlots:t._u([{key:"item",fn:function({item:i,isExpanded:s,expand:o}){return[e("tr",[e("td",[e(st.Z)],1),e("td",[e("router-link",{attrs:{to:{name:"DomainDetail",params:{id:i.pk}}}},[t._v(" "+t._s(i.name)+" ")]),"relaydomain"===i.type?e(nt.Z,{staticClass:"ml-2",attrs:{small:"",color:"primary"}},[e("translate",[t._v("Relay")])],1):t._e(),i.enabled?t._e():e("translate",{staticClass:"ml-2 grey--text"},[t._v("(disabled)")])],1),e("td",[t._v(" "+t._s(i.domainalias_count)+" aliases "),i.domainalias_count?e(a.Z,{attrs:{icon:""},on:{click:function(t){return o(!s)}}},[e(n.Z,s?[t._v("mdi-chevron-up")]:[t._v("mdi-chevron-down")])],1):t._e()],1),e("td",[e("dns-status-chip",{attrs:{status:i.dns_global_status}})],1),e("td",[e(rt.Z,{model:{value:i.allocated_quota_in_percent,callback:function(e){t.$set(i,"allocated_quota_in_percent",e)},expression:"item.allocated_quota_in_percent"}})],1),e("td",[e(rt.Z,{model:{value:i.allocated_quota_in_percent,callback:function(e){t.$set(i,"allocated_quota_in_percent",e)},expression:"item.allocated_quota_in_percent"}})],1),e("td",[e("div",{staticClass:"text-right"},[e(m.Z,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:o}){return[i.opened_alarms_count?e(at,{attrs:{bordered:"",color:"error",icon:"mdi-bell",overlap:""}},[e(a.Z,t._g(t._b({attrs:{icon:""}},"v-btn",o,!1),s),[e(n.Z,[t._v("mdi-dots-horizontal")])],1)],1):e(a.Z,t._g(t._b({attrs:{icon:""}},"v-btn",o,!1),s),[e(n.Z,[t._v("mdi-dots-horizontal")])],1)]}}],null,!0)},[e("menu-items",{attrs:{items:t.getDomainMenuItems(i),object:i}})],1)],1)])])]}},{key:"expanded-item",fn:function({headers:i,item:a}){return[e("tr",{staticClass:"grey lighten-4"},[e("td",{attrs:{colspan:i.length}},t._l(t.aliases[a.name],(function(i){return e("span",{key:i.name,staticClass:"mr-4"},[e("a",{staticClass:"mr-2",attrs:{href:"#"},on:{click:function(e){return t.editDomainAlias(a,i)}}},[t._v(t._s(i.name))]),e(nt.Z,{attrs:{"x-small":"",color:"success"}},[t._v("DNS OK")])],1)})),0)])]}}]),model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}),e("confirm-dialog",{ref:"confirm"},[e(st.Z,{attrs:{label:t._f("translate")("Do not delete domain folder"),"hide-details":""},model:{value:t.keepDomainFolder,callback:function(e){t.keepDomainFolder=e},expression:"keepDomainFolder"}})],1),e(s.Z,{attrs:{persistent:"","max-width":"800px"},model:{value:t.showAliasForm,callback:function(e){t.showAliasForm=e},expression:"showAliasForm"}},[e("domain-alias-form",{attrs:{"domain-alias":t.selectedDomainAlias},on:{close:t.closeDomainAliasForm,"alias-created":t.domainAliasCreated,"alias-deleted":t.domainAliasDeleted}})],1),e(s.Z,{attrs:{persistent:"","max-width":"800px"},model:{value:t.showAdminList,callback:function(e){t.showAdminList=e},expression:"showAdminList"}},[e("administrator-list",{attrs:{domain:t.selectedDomain,"dialog-mode":""},on:{close:function(e){t.showAdminList=!1}}})],1)],1)},mt=[],dt=i(322),ct=i(9958),ht=function(){var t=this,e=t._self._c;return e(nt.Z,{attrs:{color:t.chipType,small:""}},[t._v(" "+t._s(t.label)+" ")])},ut=[],pt={props:["status"],computed:{label(){return"disabled"===this.status?this.$gettext("Disabled"):"pending"===this.status?this.$gettext("Pending"):"critical"===this.status?this.$gettext("Problem"):"ok"===this.status?this.$gettext("Valid"):this.$gettext("Unknown")},chipType(){return"disabled"===this.status?"":"pending"===this.status?"info":"critical"===this.status?"error":"ok"===this.status?"success":"warning"}}},ft=pt,_t=(0,D.Z)(ft,ht,ut,!1,null,null,null),gt=_t.exports,vt=i(8658),bt={components:{AdministratorList:dt.Z,ConfirmDialog:ct.Z,"dns-status-chip":gt,DomainAliasForm:S,MenuItems:vt.Z},computed:(0,y.Se)({domains:"domains/domains"}),data(){return{headers:[{text:this.$gettext("Name"),value:"name"},{text:this.$gettext("Aliases"),value:"domainalias_count"},{text:this.$gettext("DNS status"),value:"dns_global_status",sortable:!1},{text:this.$gettext("Sending limit"),value:"message_limit"},{text:this.$gettext("Quota"),value:"allocated_quota_in_percent"},{text:this.$gettext("Actions"),value:"actions",sortable:!1,align:"right"}],keepDomainFolder:!1,selectedDomain:null,selectedDomainAlias:null,showAdminList:!1,showConfirmDialog:!1,showAliasForm:!1,search:"",selected:[],expanded:[],aliases:{}}},created(){this.$store.dispatch("domains/getDomains")},methods:{closeDomainAliasForm(){this.showAliasForm=!1,this.selectedDomain=null,this.selectedDomainAlias=null},async deleteDomain(t){const e=await this.$refs.confirm.open(this.$gettext("Warning"),this.$gettextInterpolate("Do you really want to delete the domain %{ domain }?",{domain:t.name}),{color:"error",cancelLabel:this.$gettext("No"),agreeLabel:this.$gettext("Yes")});if(!e)return;const i={keep_folder:this.keepDomainFolder};this.$store.dispatch("domains/deleteDomain",{id:t.pk,data:i}).then((t=>{A.$.$emit("notification",{msg:this.$gettext("Domain deleted")}),this.keepDomainFolder=!1}))},domainAliasCreated(t){this.$store.dispatch("domains/getDomains")},domainAliasDeleted(){const t=this.aliases[this.selectedDomain.name].filter((t=>t.pk!==this.selectedDomainAlias.pk));this.$set(this.aliases,this.selectedDomain.name,t),t.length||(this.expanded=[]),this.$store.dispatch("domains/getDomains"),this.closeDomainAliasForm()},editDomain(t){this.$router.push({name:"DomainEdit",params:{id:t.pk}})},editDomainAlias(t,e){this.selectedDomain=t,this.selectedDomainAlias=e,this.showAliasForm=!0},loadAliases({item:t,value:e}){e&&f.Z.getDomainAliases(t.name).then((e=>{this.$set(this.aliases,t.name,e.data)}))},openAdminList(t){this.selectedDomain=t,this.showAdminList=!0},showAliases(t){this.expanded=[{item:t}]},getDomainMenuItems(t){const e=[{label:this.$gettext("Administrators"),icon:"mdi-account-supervisor",onClick:this.openAdminList},{label:this.$gettext("Edit"),icon:"mdi-circle-edit-outline",onClick:this.editDomain},{label:this.$gettext("Delete"),icon:"mdi-delete-outline",onClick:this.deleteDomain,color:"red"}];return t.opened_alarms_count&&e.push({label:this.$gettext("Alarms"),icon:"mdi-bell",color:"red",onClick:()=>this.$router.push({name:"Alarms"})}),e}}},xt=bt,$t=(0,D.Z)(xt,lt,mt,!1,null,"905c3f4e",null),kt=$t.exports,yt=i(1202),At=i(8464),Zt={mixins:[yt.d],components:{DomainAliasForm:S,DomainCreationForm:V,DomainList:kt,ImportForm:At.Z},data(){return{showAliasForm:!1,showDomainWizard:!1,showImportForm:!1}},methods:{exportDomains(){f.Z.exportAll().then((t=>{this.exportContent(t.data,"domains")}))},importDomains(t){this.importContent(f.Z,t)}}},wt=Zt,Dt=(0,D.Z)(wt,u,p,!1,null,"eaa2cca2",null),Ct=Dt.exports}}]);
//# sourceMappingURL=176.67edef1c.js.map