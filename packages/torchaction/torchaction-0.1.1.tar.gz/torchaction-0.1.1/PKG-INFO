Metadata-Version: 2.1
Name: torchaction
Version: 0.1.1
Summary: Action for train/test in pytorch
Author-Email: TaoChenyue <3038816978@qq.com>
License: MIT
Requires-Python: >=3.8
Requires-Dist: pillow>=9.4.0
Requires-Dist: tqdm>=4.64.1
Requires-Dist: pyyaml>=6.0
Requires-Dist: setuptools>=67.4.0
Requires-Dist: torchmetrics>=0.11.1
Requires-Dist: tensorboardX>=2.6
Description-Content-Type: text/markdown

# pytorch basic frame
[![pdm-managed](https://img.shields.io/badge/pdm-managed-blueviolet)](https://pdm.fming.dev)
## Table of Contents

- [About](#about)
- [Getting Started](#getting_started)
- [Usage](#usage)

## About <a name = "about"></a>

By providing datasets, configuration files, and some scripts, you can use this framework to get results without refactoring the code.

## Getting Started <a name = "getting_started"></a>

### Prerequisites
develop environment:
```
# pip install
Pillow==9.4.0
PyYAML==6.0
setuptools==65.6.3
tensorboardX==2.6
torch==1.13.1+cu117
torchmetrics==0.11.1
torchvision==0.14.1+cu117
tqdm==4.64.1
```

### Installing
```
pip install torchaction
```


## Usage <a name = "usage"></a>

### arguments
for datasets:
+ root: root path of dataset relative to cwd, eg. 'datasets/'.
+ classes: a list of class names, eg. [cat,dog,fish]. Put this attribute in your dataset is recommand.
+ split_rate: rate for split datasets, eg. [0.7,0.3]

for train:
+ gpus: gpus that used, default is [] (means cpu), [0] or [0,1] is ok.
+ epochs
+ batch_size
+ lr

for save results:
+ save_name: str for save model name
+ save_suffix: eg. tar, pth

for config in yaml/yml file:
+ config: path of config file, eg. config.yml.

Defining other arguments in your config file is permitted.

priority:
cmd line > config.yml > default

### demo
```python
# main.py
import torch
from torch.utils.data import Subset
from torchvision.datasets import MNIST
from torchvision.models import resnet34
from torchvision import transforms
import torchmetrics
from torchaction.action import Action

project = Action()
# prepare data
transform = transforms.ToTensor()
target_transform = lambda x: torch.tensor(x, dtype=torch.long)
project.dataset = MNIST(
    root="datasets",
    train=True,
    download=True,
    transform=transform,
    target_transform=target_transform,
)
project.dataset = Subset(project.dataset,list(range(100)))
# prepare model
project.model = resnet34()
project.model.fc = torch.nn.Linear(
    project.model.fc.in_features, len(project.CLASSES)
)
project.model = torch.nn.Sequential(torch.nn.Conv2d(1, 3, 3, 1), project.model)
# prepare train
project.loss_fun=torch.nn.CrossEntropyLoss()
project.optimizer=torch.optim.Adam(project.model.parameters(),project.LR)
# prepare metrics
project.output_formater=lambda x: torch.max(x,dim=1).indices
project.train_metrics={
    'acc':torchmetrics.Accuracy(task="multiclass",num_classes=len(project.CLASSES)),
    'prec':torchmetrics.Precision(task="multiclass",num_classes=len(project.CLASSES)),
    'recall':torchmetrics.Recall(task="multiclass",num_classes=len(project.CLASSES)),
    'f1':torchmetrics.F1Score(task="multiclass",num_classes=len(project.CLASSES)),
}
project.valid_metrics={
    'acc':torchmetrics.Accuracy(task="multiclass",num_classes=len(project.CLASSES)),
    'prec':torchmetrics.Precision(task="multiclass",num_classes=len(project.CLASSES)),
    'recall':torchmetrics.Recall(task="multiclass",num_classes=len(project.CLASSES)),
    'f1':torchmetrics.F1Score(task="multiclass",num_classes=len(project.CLASSES)),
}
# prepare save
project.best_ckpt_selectors=['acc']
project.train()
```
