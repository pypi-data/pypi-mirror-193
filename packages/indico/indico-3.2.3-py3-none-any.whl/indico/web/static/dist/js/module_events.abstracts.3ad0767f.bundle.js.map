{"version":3,"file":"js/module_events.abstracts.3ad0767f.bundle.js","mappings":"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","sources":["webpack:///indico/modules/events/abstracts/client/js/boa.jsx","webpack:///indico/modules/events/abstracts/client/js/index.js"],"sourcesContent":["// This file is part of Indico.\n// Copyright (C) 2002 - 2023 CERN\n//\n// Indico is free software; you can redistribute it and/or\n// modify it under the terms of the MIT License; see the\n// LICENSE file for more details.\n\nimport customBOAURL from 'indico-url:abstracts.manage_custom_boa';\nimport uploadBOAFileURL from 'indico-url:abstracts.upload_boa_file';\n\nimport PropTypes from 'prop-types';\nimport React, {useState} from 'react';\nimport ReactDOM from 'react-dom';\nimport {Modal, Button} from 'semantic-ui-react';\n\nimport {FinalSingleFileManager} from 'indico/react/components';\nimport {fileDetailsShape} from 'indico/react/components/files/props';\nimport {handleSubmitError} from 'indico/react/forms';\nimport {FinalModalForm} from 'indico/react/forms/final-form';\nimport {Translate} from 'indico/react/i18n';\nimport {indicoAxios, handleAxiosError} from 'indico/utils/axios';\n\nexport default function CustomBOAModal({eventId, initialFile, hasLatex}) {\n  const [modalOpen, setModalOpen] = useState(false);\n  const [deleting, setDeleting] = useState(false);\n  const [confirmDeleteOpen, setConfirmDeleteOpen] = useState(false);\n\n  const deleteExistingBOA = async () => {\n    setDeleting(true);\n    try {\n      await indicoAxios.delete(customBOAURL({event_id: eventId}));\n    } catch (e) {\n      handleAxiosError(e);\n      setDeleting(false);\n      return;\n    }\n    location.reload();\n  };\n\n  const handleSubmit = async ({file}) => {\n    try {\n      await indicoAxios.post(customBOAURL({event_id: eventId}), {file});\n    } catch (e) {\n      return handleSubmitError(e);\n    }\n    location.reload();\n    // never finish submitting to avoid fields being re-enabled\n    await new Promise(() => {});\n  };\n\n  let buttonLabel;\n  if (hasLatex) {\n    buttonLabel = initialFile\n      ? Translate.string('Manage custom PDF')\n      : Translate.string('Upload custom PDF');\n  } else {\n    buttonLabel = initialFile ? Translate.string('Manage PDF') : Translate.string('Upload PDF');\n  }\n\n  return (\n    <>\n      <span\n        className={`i-button ${initialFile ? 'icon-file-pdf' : 'icon-arrow-up'}`}\n        style={{marginRight: '0.3rem'}}\n        onClick={() => setModalOpen(true)}\n      >\n        {buttonLabel}\n      </span>\n      {modalOpen && (\n        <FinalModalForm\n          id=\"custom-boa\"\n          onClose={() => setModalOpen(false)}\n          onSubmit={handleSubmit}\n          submitLabel={Translate.string('Upload BoA')}\n          initialValues={{file: initialFile ? initialFile.uuid : null}}\n          size=\"small\"\n          header={\n            hasLatex ? (\n              <Translate>Manage custom Book of Abstracts</Translate>\n            ) : (\n              <Translate>Manage Book of Abstracts</Translate>\n            )\n          }\n          extraActions={fprops =>\n            initialFile !== null && (\n              <Button\n                style={{marginRight: 'auto'}}\n                onClick={() => setConfirmDeleteOpen(true)}\n                disabled={fprops.submitting}\n                negative\n              >\n                {hasLatex ? (\n                  <Translate>Delete custom PDF</Translate>\n                ) : (\n                  <Translate>Delete current PDF</Translate>\n                )}\n              </Button>\n            )\n          }\n        >\n          <div style={{marginBottom: '20px', textAlign: 'center'}}>\n            <FinalSingleFileManager\n              name=\"file\"\n              validExtensions={['pdf']}\n              initialFileDetails={initialFile}\n              uploadURL={uploadBOAFileURL({event_id: eventId})}\n              required\n              hideValidationError\n            />\n          </div>\n          <div className=\"description\" style={{margin: '10px'}}>\n            {hasLatex ? (\n              <Translate>\n                You can upload a custom PDF for your Book of Abstracts. Please note that this\n                overrides the autogenerated file. To switch back to the default book of abstracts\n                you'll have to delete the custom file.\n              </Translate>\n            ) : (\n              <Translate>You can upload a PDF file with the Book of Abstracts here.</Translate>\n            )}\n          </div>\n        </FinalModalForm>\n      )}\n      <Modal\n        open={confirmDeleteOpen}\n        onClose={() => setConfirmDeleteOpen(false)}\n        size=\"tiny\"\n        closeOnDimmerClick={false}\n      >\n        <Modal.Header content={Translate.string('Confirm deletion')} />\n        <Modal.Content>\n          {hasLatex ? (\n            <Translate>\n              Do you really want to delete the custom Book of Abstracts? This will revert to the\n              default auto-generated one.\n            </Translate>\n          ) : (\n            <Translate>\n              Do you really want to delete the Book of Abstracts? This will disable the Book of\n              Abstracts until you upload a new one.\n            </Translate>\n          )}\n        </Modal.Content>\n        <Modal.Actions>\n          <Button onClick={() => setConfirmDeleteOpen(false)} disabled={deleting}>\n            <Translate>Cancel</Translate>\n          </Button>\n          <Button negative onClick={deleteExistingBOA} disabled={deleting} loading={deleting}>\n            <Translate>Delete</Translate>\n          </Button>\n        </Modal.Actions>\n      </Modal>\n    </>\n  );\n}\n\nCustomBOAModal.propTypes = {\n  eventId: PropTypes.number.isRequired,\n  hasLatex: PropTypes.bool.isRequired,\n  initialFile: fileDetailsShape,\n};\n\nCustomBOAModal.defaultProps = {\n  initialFile: null,\n};\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const container = document.querySelector('#boa-custom-upload');\n  if (!container) {\n    return;\n  }\n  const eventId = parseInt(container.dataset.eventId, 10);\n  const customFile = JSON.parse(container.dataset.file);\n  const hasLatex = 'hasLatex' in container.dataset;\n  ReactDOM.render(\n    <CustomBOAModal eventId={eventId} initialFile={customFile} hasLatex={hasLatex} />,\n    container\n  );\n});\n","// This file is part of Indico.\n// Copyright (C) 2002 - 2023 CERN\n//\n// Indico is free software; you can redistribute it and/or\n// modify it under the terms of the MIT License; see the\n// LICENSE file for more details.\n\n/* global setupListGenerator:false, setupSearchBox:false, handleAjaxError:false */\n\nimport _ from 'lodash';\n\nimport {$T} from 'indico/utils/i18n';\n\nimport 'indico/modules/events/reviews';\nimport 'indico/modules/events/util/types_dialog';\nimport 'indico/react/components/AffiliationPopup';\n\nimport './boa';\n\n(function(global) {\n  global.setupAbstractList = function setupAbstractList() {\n    const abstractListContainer = $('#abstract-list');\n\n    const filterConfig = {\n      itemHandle: 'tr',\n      listItems: '#abstract-list tbody tr',\n      term: '#search-input',\n      state: '#filtering-state',\n      placeholder: '#filter-placeholder',\n    };\n    const applySearchFilters = setupListGenerator(filterConfig);\n    abstractListContainer.on('indico:htmlUpdated', function() {\n      abstractListContainer.find('.js-mathjax').mathJax();\n      _.defer(applySearchFilters);\n    });\n  };\n\n  global.setupAbstractEmailTemplatesPage = function setupAbstractEmailTemplatesPage() {\n    $('.js-edit-tpl-dropdown')\n      .parent()\n      .dropdown();\n    $('.email-templates > ul').sortable({\n      axis: 'y',\n      containment: 'parent',\n      cursor: 'move',\n      distance: 2,\n      handle: '.ui-i-box-sortable-handle',\n      items: '> li',\n      tolerance: 'pointer',\n      forcePlaceholderSize: true,\n      placeholder: 'regform-section-sortable-placeholder',\n      update() {\n        const $elem = $('.email-templates > ul');\n        const sortedList = $elem\n          .find('li.js-email-template')\n          .map((i, elem) => $(elem).data('id'))\n          .get();\n\n        $.ajax({\n          url: $elem.data('url'),\n          method: 'POST',\n          contentType: 'application/json',\n          data: JSON.stringify({sort_order: sortedList}),\n          complete: IndicoUI.Dialogs.Util.progress(),\n          error: handleAjaxError,\n        });\n      },\n    });\n\n    $('.email-preview-btn').on('click', function(evt) {\n      evt.preventDefault();\n      const id = $(this).data('id');\n      const $previewBtn = $(`#email-preview-btn-${id}`);\n      if ($previewBtn.data('visible')) {\n        $previewBtn.text($T.gettext('Show preview'));\n        $(`#email-preview-${id}`).slideToggle();\n        $previewBtn.data('visible', false);\n      } else {\n        $previewBtn.text($T.gettext('Hide preview'));\n        $(`#email-preview-${id}`).slideToggle();\n        $previewBtn.data('visible', true);\n      }\n    });\n\n    $('#email-template-manager .ui-i-box-sortable-handle').on('mousedown', function() {\n      $('.email-preview').hide();\n      $('.email-preview-btn')\n        .text($T.gettext('Show preview'))\n        .data('visible', false);\n    });\n\n    $('.js-toggle-stop-on-match').on('click', function(evt) {\n      evt.preventDefault();\n      const $this = $(this);\n      const stopOnMatch = !$this.data('stop-on-match');\n\n      if ($this.hasClass('disabled')) {\n        return;\n      }\n\n      $.ajax({\n        url: $this.data('href'),\n        method: $this.data('method'),\n        data: JSON.stringify({stop_on_match: stopOnMatch}),\n        dataType: 'json',\n        contentType: 'application/json',\n        error: handleAjaxError,\n        success() {\n          $this.data('stop-on-match', stopOnMatch);\n          $this.toggleClass('stop-processing-enabled', stopOnMatch);\n        },\n      });\n    });\n  };\n\n  global.setupCallForAbstractsPage = function setupCallForAbstractsPage(options) {\n    options = $.extend(\n      {\n        hasAbstracts: false,\n      },\n      options\n    );\n\n    // show the form after login when using the submit button as a guest\n    if (location.hash === '#submit-abstract') {\n      $(document).ready(function() {\n        $('.js-show-abstract-form').trigger('click');\n      });\n    }\n\n    if (options.hasAbstracts) {\n      const filterConfig = {\n        itemHandle: 'div.contribution-row',\n        listItems: '#display-contribution-list div.contribution-row',\n        term: '#search-input',\n        state: '#filtering-state',\n        placeholder: '#filter-placeholder',\n      };\n\n      const applySearchFilters = setupSearchBox(filterConfig);\n      applySearchFilters();\n    }\n  };\n\n  global.setupAbstractJudgment = function setupAbstractJudgment(options) {\n    options = $.extend(\n      {\n        trackSessionMap: {},\n      },\n      options\n    );\n\n    $('body').on('change', '#accepted_track', function() {\n      const sessionId = options.trackSessionMap[$(this).val()];\n      $('#session').val(sessionId || '__None');\n    });\n    $('#accepted_track').trigger('change');\n  };\n})(window);\n"],"names":["CustomBOAModal","eventId","initialFile","hasLatex","modalOpen","setModalOpen","useState","deleting","setDeleting","confirmDeleteOpen","setConfirmDeleteOpen","buttonLabel","Translate","className","style","marginRight","onClick","id","onClose","onSubmit","async","file","indicoAxios","customBOAURL","event_id","e","handleSubmitError","location","reload","Promise","submitLabel","initialValues","uuid","size","header","extraActions","fprops","Button","disabled","submitting","negative","marginBottom","textAlign","FinalSingleFileManager","name","validExtensions","initialFileDetails","uploadURL","uploadBOAFileURL","required","hideValidationError","margin","Modal","open","closeOnDimmerClick","content","handleAxiosError","loading","global","propTypes","PropTypes","fileDetailsShape","defaultProps","document","addEventListener","container","querySelector","parseInt","dataset","customFile","JSON","parse","ReactDOM","window","setupAbstractList","abstractListContainer","$","applySearchFilters","setupListGenerator","itemHandle","listItems","term","state","placeholder","on","find","mathJax","setupAbstractEmailTemplatesPage","parent","dropdown","sortable","axis","containment","cursor","distance","handle","items","tolerance","forcePlaceholderSize","update","$elem","sortedList","map","i","elem","data","get","ajax","url","method","contentType","stringify","sort_order","complete","IndicoUI","Dialogs","Util","progress","error","handleAjaxError","evt","preventDefault","this","$previewBtn","text","$T","slideToggle","hide","$this","stopOnMatch","hasClass","stop_on_match","dataType","success","toggleClass","setupCallForAbstractsPage","options","extend","hasAbstracts","hash","ready","trigger","setupSearchBox","setupAbstractJudgment","trackSessionMap","sessionId","val"],"sourceRoot":""}