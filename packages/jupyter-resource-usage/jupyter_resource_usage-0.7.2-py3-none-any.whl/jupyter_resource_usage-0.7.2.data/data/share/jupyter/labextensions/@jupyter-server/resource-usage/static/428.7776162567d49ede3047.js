"use strict";(self.webpackChunk_jupyter_server_resource_usage=self.webpackChunk_jupyter_server_resource_usage||[]).push([[428],{428:(e,t,r)=>{r.r(t),r.d(t,{default:()=>I});var s=r(866),n=r(767),a=r(591),o=r(510),i=r(468),l=r(431),c=r(271),m=r.n(c),u=r(886),d=r(258);const _={B:1,KB:1024,MB:1048576,GB:1073741824,TB:1099511627776,PB:0x4000000000000};function h(e){const t=g(e);return t[0].toFixed(2)+" "+t[1]}function g(e){return e?e<_.KB?[e,"B"]:_.KB===e||e<_.MB?[e/_.KB,"KB"]:_.MB===e||e<_.GB?[e/_.MB,"MB"]:_.GB===e||e<_.TB?[e/_.GB,"GB"]:_.TB===e||e<_.PB?[e/_.TB,"TB"]:[e/_.PB,"PB"]:[0,"B"]}let p=null;const v=e=>{const{reason:t}=e;return"not_supported"===t.reason?m().createElement("div",{className:"jp-KernelUsage-section-separator"},e.trans.__("Please check with your system administrator that you are running IPyKernel version 6.10.0 or above."),t.kernel_version?e.trans.__("Detected IPyKernel version: %1",t.kernel_version):e.trans.__("No IPyKernel installation detected.")):"no_kernel_widget"===t.reason?m().createElement("div",{className:"jp-KernelUsage-section-separator"},e.trans.__("Switch to a notebook or console to see kernel usage details.")):"no_kernel"===t.reason?m().createElement("div",{className:"jp-KernelUsage-section-separator"},e.trans.__("No active kernel found.")):m().createElement("div",{className:"jp-KernelUsage-section-separator"},e.trans.__("Reason: %1.",t.reason))},y=e=>{var t;const{panel:r}=e,[s,n]=(0,c.useState)(),[a,o]=(0,c.useState)(),[i,l]=(0,c.useState)(),[_,g]=(0,c.useState)({reason:"loading"});((e,t)=>{const r=(0,c.useRef)();(0,c.useEffect)((()=>{r.current=e}),[e]),(0,c.useEffect)((()=>{if(null!==t){const e=setInterval((function(){r.current&&r.current()}),t);return()=>{clearInterval(e)}}}),[e,t])})((async()=>{s&&r.isVisible&&C(s).catch((()=>{console.warn(`Request failed for ${s}. Kernel restarting?`)}))}),5e3);const y=(0,c.useRef)(s);y.current=s;const C=e=>async function(e="",t={}){const r=d.ServerConnection.makeSettings(),s=u.URLExt.join(r.baseUrl,"api/metrics/v1/kernel_usage",e);let n;try{n=await d.ServerConnection.makeRequest(s,t,r)}catch(e){throw new d.ServerConnection.NetworkError(e)}let a=await n.text();if(a.length>0)try{a=JSON.parse(a)}catch(e){console.log("Not a JSON response body.",n)}if(!n.ok)throw new d.ServerConnection.ResponseError(n,a.message||a);return a}(`get_usage/${e}`).then((t=>{var r;if(e!==y.current)return;if(null===(r=t.content)||void 0===r?void 0:r.reason){const e=t.content;return void g(e)}g(void 0);const s={...t.content,timestamp:new Date,kernel_id:e};l(s)}));return(0,c.useEffect)((()=>{const t=e=>(t,r)=>{var s,a;const i=null===(s=r.newValue)||void 0===s?void 0:s.id;if(i){n(i);const t=null===(a=null==e?void 0:e.sessionContext.session)||void 0===a?void 0:a.model.path;o(t),C(i)}else g({reason:"no_kernel"}),n(i)},r=(e,r)=>{var a,i,c,m,u;if(null===r)return n(void 0),void g({reason:"no_kernel_widget"});if(p&&p.panel.sessionContext.kernelChanged.disconnect(p.callback),p={callback:t(r),panel:r},r.sessionContext.kernelChanged.connect(p.callback),(null===(i=null===(a=r.sessionContext.session)||void 0===a?void 0:a.kernel)||void 0===i?void 0:i.id)!==s){const e=null===(m=null===(c=r.sessionContext.session)||void 0===c?void 0:c.kernel)||void 0===m?void 0:m.id;if(e){n(e);const t=null===(u=r.sessionContext.session)||void 0===u?void 0:u.model.path;o(t),l(void 0),g({reason:"loading"}),C(e)}else n(void 0),g({reason:"no_kernel"})}};return e.currentChanged.connect(r),()=>{e.currentChanged.disconnect(r)}}),[s]),_&&"timeout"!==(null==_?void 0:_.reason)&&"loading"!==(null==_?void 0:_.reason)?m().createElement(m().Fragment,null,m().createElement("h3",{className:"jp-KernelUsage-section-separator"},e.trans.__("Kernel usage not available")),m().createElement(v,{trans:e.trans,reason:_})):s?m().createElement(m().Fragment,null,m().createElement("h3",{className:"jp-KernelUsage-section-separator"},e.trans.__("Kernel usage")),"timeout"===(null==_?void 0:_.reason)?m().createElement("strong",null,e.trans.__("Timed out in: %1 ms",_.timeout_ms)):null,m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Notebook:")," ",a),m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Kernel ID:")," ",s),m().createElement("div",{className:"timeout"===(null==_?void 0:_.reason)?"jp-KernelUsage-timedOut":""},i?m().createElement(m().Fragment,null,m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Kernel Host:")," ",i.hostname),m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Timestamp:")," ",null===(t=i.timestamp)||void 0===t?void 0:t.toLocaleString()),m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Process ID:")," ",i.pid),m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("CPU:")," ",i.kernel_cpu),m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Memory:")," ",h(i.kernel_memory)),m().createElement("hr",{className:"jp-KernelUsage-section-separator"}),m().createElement("h4",{className:"jp-KernelUsage-section-separator"},e.trans.__("Host CPU")),i.host_cpu_percent&&m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans._n("%2%% used on %1 CPU","%2%% used on %1 CPUs",i.cpu_count,i.host_cpu_percent.toFixed(1))),m().createElement("h4",{className:"jp-KernelUsage-section-separator"},e.trans.__("Host Virtual Memory")),m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Active:")," ",h(i.host_virtual_memory.active)),m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Available:")," ",h(i.host_virtual_memory.available)),m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Free:")," ",h(i.host_virtual_memory.free)),m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Inactive:")," ",h(i.host_virtual_memory.inactive)),i.host_virtual_memory.percent&&m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Percent used:")," ",i.host_virtual_memory.percent.toFixed(1),"%"),m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Total:")," ",h(i.host_virtual_memory.total)),m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Used:")," ",h(i.host_virtual_memory.used)),m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Wired:")," ",h(i.host_virtual_memory.wired))):"loading"===(null==_?void 0:_.reason)?m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Loadingâ€¦")):m().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Usage data is missing")))):m().createElement("h3",null,e.trans.__("Kernel usage is missing"))};class C extends o.ReactWidget{constructor(e){super(),this._currentChanged=e.currentChanged,this._panel=e.panel,this._trans=e.trans,this.addClass("jp-KernelUsage-content")}render(){return m().createElement(y,{currentChanged:this._currentChanged,panel:this._panel,trans:this._trans})}}const f='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\r\n  <g class="jp-icon3" fill="#616161">\r\n    <path d="m256 43c-141 0-256 115-256 256 0 62 22 118 59 163l6 8h383l6-8c37-44 59-101 59-163-0.1-141-115-256-256-256zm0 43c118 0 213 95 213 213 0 48-17 92-44 128h-339c-27-36-44-80-44-128 0-118 95-213 213-213zm0 21c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.5-21-21-21zm-85 23c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.6-21-21-21zm171 0c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.5-21-21-21zm-233 63c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.5-21-21-21zm290 0.7-121 69c-6.3-3.7-14-6-21-6-24 0-43 19-43 43s19 43 43 43c23 0 42-19 43-42v-0.7l121-69-21-37zm-313 85c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.5-21-21-21zm341 0c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.6-21-21-21zm-319 85c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.5-21-21-21zm296 0c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.5-21-21-21z"/>\r\n  </g>\r\n</svg>\r\n\x3c!-- Downloaded from https://seekicon.com/free-icon/tachometer-alt_1 under MIT License. --\x3e\r\n';class k extends l.StackedPanel{constructor(e){super(),this.addClass("jp-KernelUsage-view"),this.id="kernelusage-panel-id",this.title.caption=e.trans.__("Kernel Usage"),this.title.icon=new a.LabIcon({name:"jupyterlab-kernel-usage:icon",svgstr:f}),this.title.closable=!0;const t=new C({currentChanged:e.currentChanged,panel:this,trans:e.trans});this.addWidget(t)}dispose(){super.dispose()}onCloseRequest(e){super.onCloseRequest(e),this.dispose()}}var E=r(169),K=r(442),U=r(722);const j=(0,r(95).style)({fontSize:"var(--jp-ui-font-size1)",fontFamily:"var(--jp-ui-font-family)"},{backgroundColor:"#FFD2D2",color:"#D8000C"});class w extends o.VDomRenderer{constructor(e){super(new w.Model({refreshRate:5e3})),this._trans=e}render(){if(!this.model)return m().createElement("div",null);let e;return e=null===this.model.memoryLimit?this._trans.__("Mem: %1 %2",this.model.currentMemory.toFixed(b.DECIMAL_PLACES),this.model.units):this._trans.__("Mem: %1 / %2 %3",this.model.currentMemory.toFixed(b.DECIMAL_PLACES),this.model.memoryLimit.toFixed(b.DECIMAL_PLACES),this.model.units),this.model.usageWarning?m().createElement(E.TextItem,{title:this._trans.__("Current memory usage"),source:e,className:j}):m().createElement(E.TextItem,{title:this._trans.__("Current memory usage"),source:e})}}var b;!function(e){class t extends o.VDomModel{constructor(e){super(),this._currentMemory=0,this._memoryLimit=null,this._metricsAvailable=!1,this._units="B",this._warn=!1,this._poll=new U.Poll({factory:()=>b.factory(),frequency:{interval:e.refreshRate,backoff:!0},name:"@jupyterlab/statusbar:MemoryUsage#metrics"}),this._poll.ticked.connect((e=>{const{payload:t,phase:r}=e.state;if("resolved"!==r){if("rejected"===r){const e=this._metricsAvailable;return this._metricsAvailable=!1,this._currentMemory=0,this._memoryLimit=null,this._units="B",void(e&&this.stateChanged.emit())}}else this._updateMetricsValues(t)}))}get metricsAvailable(){return this._metricsAvailable}get currentMemory(){return this._currentMemory}get memoryLimit(){return this._memoryLimit}get units(){return this._units}get usageWarning(){return this._warn}dispose(){super.dispose(),this._poll.dispose()}_updateMetricsValues(e){var t,r,s;const n=this._metricsAvailable,a=this._currentMemory,o=this._memoryLimit,i=this._units,l=this._warn;if(null===e)this._metricsAvailable=!1,this._currentMemory=0,this._memoryLimit=null,this._units="B",this._warn=!1;else{const n=null!==(t=e.pss)&&void 0!==t?t:e.rss,a=e.limits.memory,o=null!==(s=null!==(r=null==a?void 0:a.pss)&&void 0!==r?r:null==a?void 0:a.rss)&&void 0!==s?s:null,[i,l]=g(n),c=!!e.limits.memory&&e.limits.memory.warn;this._metricsAvailable=!0,this._currentMemory=i,this._units=l,this._memoryLimit=o?o/_[l]:null,this._warn=c}this._currentMemory===a&&this._units===i&&this._memoryLimit===o&&this._metricsAvailable===n&&this._warn===l||this.stateChanged.emit(void 0)}}e.Model=t}(w||(w={})),function(e){e.DECIMAL_PLACES=2;const t=d.ServerConnection.makeSettings(),r=u.URLExt.join(t.baseUrl,"api/metrics/v1");e.factory=async function(){const e=d.ServerConnection.makeRequest(r,{},t),s=await e;return await s.json()}}(b||(b={}));var N,B=r(840);class S{constructor(e){const{labShell:t,notebookTracker:r,consoleTracker:s}=e;this._currentChanged=new B.Signal(this),t?t.currentChanged.connect(((e,t)=>{const r=t.newValue;r&&function(e){return e instanceof i.ConsolePanel||e instanceof n.NotebookPanel}(r)?this._currentChanged.emit(r):this._currentChanged.emit(null)})):(r.currentChanged.connect(((e,t)=>{this._currentChanged.emit(t)})),s&&s.currentChanged.connect(((e,t)=>{this._currentChanged.emit(t)})))}get currentChanged(){return this._currentChanged}}!function(e){e.getKernelUsage="kernel-usage:get"}(N||(N={}));const M={id:"@jupyter-server/resource-usage:memory-status-item",autoStart:!0,requires:[E.IStatusBar,K.ITranslator],activate:(e,t,r)=>{const s=r.load("jupyter-resource-usage"),n=new w(s);t.registerStatusItem(M.id,{item:n,align:"left",rank:2,isActive:()=>n.model.metricsAvailable,activeStateChanged:n.model.stateChanged})}},x={id:"@jupyter-server/resource-usage:kernel-panel-item",autoStart:!0,optional:[o.ICommandPalette,s.ILabShell,i.IConsoleTracker],requires:[K.ITranslator,n.INotebookTracker],activate:(e,t,r,s,n,o)=>{const i=t.load("jupyter-resource-usage"),{commands:l,shell:c}=e,m=i.__("Kernel Resource");let u=null;function d(){if(!u||u.isDisposed){const e=new S({notebookTracker:r,labShell:n,consoleTracker:o});u=new k({currentChanged:e.currentChanged,trans:i}),c.add(u,"right",{rank:200})}}l.addCommand(N.getKernelUsage,{label:i.__("Kernel Usage"),caption:i.__("Kernel Usage"),icon:new a.LabIcon({name:"jupyterlab-kernel-usage:icon",svgstr:f}),execute:d}),s&&s.addItem({command:N.getKernelUsage,category:m}),d()}},I=[M,x]}}]);